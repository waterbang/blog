

<!DOCTYPE html>
<html lang="ch_CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="waterbang">
  <meta name="keywords" content="waterbang">
  
    <meta name="description" content="å‰è¨€ç¡®ä¿æ‚¨æœ‰node.jsçš„ç¯å¢ƒã€‚ å¯è¯»æµï¼ˆReadStreamï¼‰å…ˆæ¥çœ‹çœ‹æ ¸å¿ƒæ–¹æ³•å¦‚ä½•ä½¿ç”¨ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¼€å‘ä¸­çœŸæ­£ä½¿ç”¨çš„ã€‚åœ¨å·¥ä½œç›®å½•ä¸‹å…ˆåˆ›å»ºä¸€ä¸ª1.txt,å†™å…¥ ä½ å¥½ç„¶ååˆ›å»ºä¸€ä¸ªstream.js,å†…å®¹å¦‚ä¸‹ï¼š 12345678910111213let fs &#x3D; require(&#x27;fs&#x27;);let path &#x3D; require(&#x27;path&#x27;);let rs &#x3D;">
<meta property="og:type" content="article">
<meta property="og:title" content="åŸºäºnodeçš„fså®ç°å¯è¯»æµå’Œå¯å†™æµ">
<meta property="og:url" content="https://www.waterbang.top/2020/03/29/%E5%9F%BA%E4%BA%8Enode%E7%9A%84fs%E5%AE%9E%E7%8E%B0%E5%8F%AF%E8%AF%BB%E6%B5%81%E5%92%8C%E5%8F%AF%E5%86%99%E6%B5%81/index.html">
<meta property="og:site_name" content="waterbang">
<meta property="og:description" content="å‰è¨€ç¡®ä¿æ‚¨æœ‰node.jsçš„ç¯å¢ƒã€‚ å¯è¯»æµï¼ˆReadStreamï¼‰å…ˆæ¥çœ‹çœ‹æ ¸å¿ƒæ–¹æ³•å¦‚ä½•ä½¿ç”¨ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¼€å‘ä¸­çœŸæ­£ä½¿ç”¨çš„ã€‚åœ¨å·¥ä½œç›®å½•ä¸‹å…ˆåˆ›å»ºä¸€ä¸ª1.txt,å†™å…¥ ä½ å¥½ç„¶ååˆ›å»ºä¸€ä¸ªstream.js,å†…å®¹å¦‚ä¸‹ï¼š 12345678910111213let fs &#x3D; require(&#x27;fs&#x27;);let path &#x3D; require(&#x27;path&#x27;);let rs &#x3D;">
<meta property="og:locale" content="ch_CN">
<meta property="og:image" content="https://www.waterbang.top/2020/03/10/node%E4%B8%AD%E7%9A%84require%E6%96%B9%E6%B3%95/logo.jpg">
<meta property="article:published_time" content="2020-03-29T02:48:29.000Z">
<meta property="article:modified_time" content="2024-12-21T11:43:23.165Z">
<meta property="article:author" content="waterbang">
<meta property="article:tag" content="node.js">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://www.waterbang.top/2020/03/10/node%E4%B8%AD%E7%9A%84require%E6%96%B9%E6%B3%95/logo.jpg">
  
  
  <title>åŸºäºnodeçš„fså®ç°å¯è¯»æµå’Œå¯å†™æµ ğŸ® waterbang</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/atom-one-dark.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"www.waterbang.top","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":"ğŸ¦"},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":"58e161bf4b884b2aa577f323f137ac0f","google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>waterbang</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Startseite
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archiv
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Etiketten
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                Ãœber mich
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                Weblinks
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/post-banner.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="åŸºäºnodeçš„fså®ç°å¯è¯»æµå’Œå¯å†™æµ">
              
            </span>

            
              <div class="mt-3">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-author" aria-hidden="true"></i>
      waterbang
    </span>
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2020-03-29 10:48" pubdate>
        March 29, 2020 am
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      12k å­—
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      102 åˆ†é’Ÿ
    </span>
  

  
  
    
      <!-- ä¸è’œå­ç»Ÿè®¡æ–‡ç« PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> æ¬¡
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">åŸºäºnodeçš„fså®ç°å¯è¯»æµå’Œå¯å†™æµ</h1>
            
              <p class="note note-info">
                
                  æœ¬æ–‡æœ€åæ›´æ–°äºï¼š5 hours ago
                
              </p>
            
            <div class="markdown-body">
              <h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>ç¡®ä¿æ‚¨æœ‰node.jsçš„ç¯å¢ƒã€‚</p>
<h2 id="å¯è¯»æµï¼ˆReadStreamï¼‰"><a href="#å¯è¯»æµï¼ˆReadStreamï¼‰" class="headerlink" title="å¯è¯»æµï¼ˆReadStreamï¼‰"></a>å¯è¯»æµï¼ˆReadStreamï¼‰</h2><p>å…ˆæ¥çœ‹çœ‹æ ¸å¿ƒæ–¹æ³•å¦‚ä½•ä½¿ç”¨ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¼€å‘ä¸­çœŸæ­£ä½¿ç”¨çš„ã€‚åœ¨å·¥ä½œç›®å½•ä¸‹å…ˆåˆ›å»ºä¸€ä¸ª<code>1.txt</code>,å†™å…¥ ä½ å¥½<br>ç„¶ååˆ›å»ºä¸€ä¸ª<code>stream.js</code>,å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">let fs = require(&#x27;fs&#x27;);<br>let path = require(&#x27;path&#x27;);<br><br>let rs = fs.createReadStream(path.resolve(__dirname,&#x27;1.txt&#x27;))<br>let arr = [];<br><br>rs.on(&#x27;data&#x27;,function(data)&#123; // buffer<br>    arr.push(data);<br>&#125;)<br>rs.on(&#x27;end&#x27;,function()&#123;<br>   console.log(Buffer.concat(arr).toString());<br>&#125;);<br><br></code></pre></div></td></tr></table></figure>

<p>ä¸Šé¢ä»£ç ä¸­æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªarræ•°ç»„æ¥å­˜æˆ‘ä»¬æ¯æ¬¡è¯»å–çš„äºŒè¿›åˆ¶æ•°æ®ã€‚å…¶å½¢å¼ä¸ºbufferã€‚<br>å…¶å†…éƒ¨æ¯æ¬¡è¯»å–åˆ°æ•°æ®å°±ä¼šè§¦å‘æˆ‘ä»¬ç›‘å¬çš„<code>data</code>äº‹ä»¶ã€‚ç„¶åæŠŠæ•°æ®è¿”è¿˜ç»™æˆ‘ä»¬ï¼Œè€Œ<code>end</code>äº‹ä»¶æ˜¯ç»“æŸæ—¶è§¦å‘çš„ã€‚ä¸¤è€…éƒ½æ˜¯å›ºå®šçš„ã€‚<br>ä¸Šé¢è°ƒç”¨<code>fs.createReadStream()</code> é»˜è®¤æ˜¯æµæ˜¯æš‚åœçš„ï¼Œåªæœ‰æˆ‘ä»¬æ‰‹åŠ¨ç›‘å¬<code>data</code>äº‹ä»¶çš„æ—¶å€™æ‰ä¼šè¿›è¡Œæ•°æ®è¯»å–ã€‚</p>
<blockquote>
<p>å†…éƒ¨è§¦å‘äº‹ä»¶å…·ä½“çœ‹<a target="_blank" rel="noopener" href="http://nodejs.cn/api/fs.html#fs_class_fs_readstream">å®˜æ–¹æ–‡æ¡£</a></p>
</blockquote>
<h3 id="å¯ä¼ çš„å‚æ•°"><a href="#å¯ä¼ çš„å‚æ•°" class="headerlink" title="å¯ä¼ çš„å‚æ•°"></a>å¯ä¼ çš„å‚æ•°</h3><p><code>fs.createReadStream(pathï¼Œ[options])</code>çš„ç¬¬äºŒä¸ªå‚æ•°å…è®¸æˆ‘ä»¬è¿›è¡Œä¼ å‚ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹å„ä¸ªå‚æ•°çš„ä½œç”¨ã€‚</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">let rs = fs.createReadStream(&#x27;./1.txt&#x27;,&#123;<br>    flags:&#x27;r&#x27;, // å½“å‰è¦åšä»€ä¹ˆæ“ä½œï¼Œå…·ä½“å¯ä»¥çœ‹ä¸‹é¢çš„æ–‡ä»¶ç³»ç»Ÿæ ‡å¿—<br>    encoding:null, // é»˜è®¤æ˜¯buffer<br>    highWaterMark:2,// å†…éƒ¨ä¼šåˆ›å»º 64kå¤§çš„buffer<br>    mode:438,// æ–‡ä»¶çš„æƒé™ 438ä¸º8è¿›åˆ¶ï¼Œæ¢æˆäºŒè¿›åˆ¶ä¸º110110110<br>    autoClose:true, //é»˜è®¤ä¸ºtrue ,åœ¨`error`æˆ–`end` äº‹ä»¶æ—¶ï¼Œæ–‡ä»¶æè¿°ç¬¦ä¼šè‡ªåŠ¨å…³é—­ã€‚<br>    start:0,<br>    end:6 // start å’Œ end å°±æ˜¯è¯»å–ä¸€å®šèŒƒå›´çš„å­—èŠ‚ã€‚<br>&#125;);<br></code></pre></div></td></tr></table></figure>
<ol>
<li><code>flags</code> å…·ä½“è¦è¿›è¡Œçš„æ“ä½œï¼Œå¦‚è¯»å– <code>r</code> æˆ–è€…å†™å…¥ <code>w</code>ã€‚ é»˜è®¤ r</li>
<li><code>encoding</code>  å…¶å¯ä»¥æ˜¯ Buffer æ¥å—çš„ä»»ä½•ä¸€ç§å­—ç¬¦ç¼–ç ã€‚ é»˜è®¤ null</li>
<li><code>fd</code> å¦‚æœæŒ‡å®šï¼Œå…¶å†…éƒ¨å°†ä¼šå¿½ç•¥pathå‚æ•°ï¼Œå¹¶ä½¿ç”¨æŒ‡å®šçš„æ–‡ä»¶æè¿°ç¬¦ã€‚ é»˜è®¤ä¸º null</li>
<li><code>mode</code> æ–‡ä»¶çš„æƒé™ï¼Œè·Ÿlinuxä¸€æ ·ï¼Œ4-&gt;å¯è¯» 2-&gt;å¯å†™ 1-&gt;å¯æ‰§è¡Œï¼Œ é»˜è®¤ä¸º 0o666æˆ–è€…438</li>
<li><code>autoClose</code> æ˜¯å¦åœ¨è§¦å‘erroræˆ–è€…endäº‹ä»¶æ—¶è‡ªåŠ¨å…³é—­æ–‡ä»¶ã€‚ é»˜è®¤ä¸º true</li>
<li><code>emitClose</code> é»˜è®¤æƒ…å†µä¸‹ï¼Œæµåœ¨é”€æ¯åå°†ä¸ä¼šè§¦å‘ â€˜closeâ€™ äº‹ä»¶ã€‚æ›´æ”¹ä¸ºtrueå¯ä»¥æ›´æ”¹æ­¤è¡Œä¸ºã€‚ é»˜è®¤ä¸º false</li>
<li><code>start end</code> è®¾ç½®è¯»å–çš„èŒƒå›´ã€‚é»˜è®¤è¯»å–å…¨éƒ¨å†…å®¹ã€‚</li>
<li><code>highWaterMark</code> é»˜è®¤æ¯æ¬¡è¯»å–64Kï¼Œå†…éƒ¨åˆ›å»º64Kçš„ç¼“å†²åŒºï¼ˆbufferï¼‰ã€‚ é»˜è®¤ä¸º 64*1024</li>
</ol>
<blockquote>
<p>æ³¨æ„: <em>æ–‡ä»¶å†™å…¥æ—¶ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºæ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶å·²å­˜åœ¨åˆ™æˆªæ–­æ–‡ä»¶ã€‚</em><br><em>æ–‡ä»¶åœ¨è¯»å–æ—¶ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™å‡ºç°å¼‚å¸¸ã€‚</em></p>
</blockquote>
<h3 id="ReadStream-js"><a href="#ReadStream-js" class="headerlink" title="ReadStream.js"></a>ReadStream.js</h3><p>æˆ‘ä»¬åœ¨å·¥ä½œç›®å½•åˆ›å»ºæ–‡ä»¶ <code>ReadStream.js</code>,æ¥å†™æˆ‘ä»¬è‡ªå·±çš„å¯è¯»æµã€‚<br>æˆ‘ä»¬è¦å…ˆæ˜ç¡®å†…éƒ¨çš„æµåœ¨åˆ›å»ºçš„æ—¶å€™æ˜¯æš‚åœçš„ã€‚å°±è·Ÿæˆ‘ä»¬çš„é¾™å¤´ä¸€æ ·ã€‚dataäº‹ä»¶å°±æ˜¯æˆ‘ä»¬çš„å¼€å…³ã€‚<br>å…¶æ¬¡å†…éƒ¨ä¸ºäº†é™ä½è€¦åˆï¼Œç”¨äº†å‘å¸ƒè®¢é˜…ã€‚<br>æˆ‘ä»¬é¦–å…ˆè¦æ”¹ä¸€ä¸‹stream.js,æ¥ç”¨ä¸Šæˆ‘ä»¬è‡ªå·±çš„ReadStreamã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">const fs = require(&#x27;fs&#x27;);<br>let ReadStream = require(&#x27;./ReadStream&#x27;);<br>let rs = new ReadStream(&#x27;./1.txt&#x27;,&#123;<br>    flags:&#x27;r&#x27;, // å½“å‰è¦åšä»€ä¹ˆæ“ä½œï¼Œå…·ä½“å¯ä»¥çœ‹ä¸‹é¢çš„æ–‡ä»¶ç³»ç»Ÿæ ‡å¿—<br>    encoding:null, // é»˜è®¤æ˜¯buffer<br>    highWaterMark:2,// å†…éƒ¨ä¼šåˆ›å»º 64kå¤§çš„buffer<br>    mode:438,// æ–‡ä»¶çš„æƒé™ 438ä¸º8è¿›åˆ¶ï¼Œæ¢æˆäºŒè¿›åˆ¶ä¸º110110110<br>    autoClose:true, //é»˜è®¤ä¸ºtrue ,åœ¨`error`æˆ–`end` äº‹ä»¶æ—¶ï¼Œæ–‡ä»¶æè¿°ç¬¦ä¼šè‡ªåŠ¨å…³é—­ã€‚<br>    start:0,<br>    end:6 // start å’Œ end å°±æ˜¯è¯»å–ä¸€å®šèŒƒå›´çš„å­—èŠ‚ã€‚<br>&#125;);<br>rs.on(&#x27;open&#x27;,function(fd)&#123;<br>    console.log(&#x27;æ–‡ä»¶æ‰“å¼€è§¦å‘openäº‹ä»¶&#x27;,fd)<br>&#125;);<br>let arr = [];<br>rs.on(&#x27;data&#x27;,function(data)&#123; // æ¯æ¬¡è¯»å–åˆ°çš„ç»“æœ<br>    console.log(data);<br>    arr.push(data); // å­˜èµ·æ¥<br>&#125;)<br>rs.on(&#x27;end&#x27;,function()&#123;<br>    console.log(&#x27;æ–‡ä»¶è¯»å–å®Œæ¯•&#x27;)<br>     console.log(Buffer.concat(arr).toString());<br>&#125;);<br>rs.on(&#x27;close&#x27;,function()&#123;<br>    console.log(&#x27;æ–‡ä»¶å…³é—­&#x27;)<br>&#125;);<br></code></pre></div></td></tr></table></figure>
<p>æ¥ä¸‹æ¥å°±å¯ä»¥åˆ›å»ºæˆ‘ä»¬è‡ªå·±çš„ReadStreamäº†ï¼Œå†…éƒ¨ä¼šåŸºäºnode.jsçš„<a target="_blank" rel="noopener" href="http://nodejs.cn/api/events.html">events</a>å’Œ<a target="_blank" rel="noopener" href="http://nodejs.cn/api/fs.html">fs</a>æ¨¡å—ã€‚<br>å…ˆå¼•å…¥ä¸¤ä¸ªæ¨¡å—ï¼Œç„¶åæˆ‘ä»¬çš„ç±»è¦ç»§æ‰¿eventsï¼Œæ¥ç€æŠŠå¸¸ç”¨çš„å¯é€‰å‚æ•°ä¼ å…¥ã€‚<br>è¯»å–çš„ç¬¬ä¸€æ­¥å°±æ˜¯è¦å°†æ–‡ä»¶æ‰“å¼€ï¼Œå€ŸåŠ©fsæ¨¡å—æˆ‘ä»¬å¯ä»¥æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶è·å¾—æ–‡ä»¶æ ‡è¯†ç¬¦ï¼Œä»¥æ–¹ä¾¿ä¸‹ä¸€æ­¥åŠ¨ä½œã€‚<br>æˆ‘ä»¬ç”¨ä¸€ä¸ª<code>flowing</code>å‚æ•°æ ‡è¯†æµæ˜¯å¦æ˜¯æš‚åœçš„ã€‚å¹¶ä¸”åœ¨æ³¨å†Œäº†<code>data</code>äº‹ä»¶ä¹‹åï¼Œå°†å…¶æ‰“å¼€ã€‚<br>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">const EventEmitter = require(&#x27;events&#x27;);<br>const fs = require(&#x27;fs&#x27;);<br>class ReadStream extends EventEmitter&#123;<br>  constructor(path, options = &#123;&#125;) &#123;<br>    super();<br>    this.path = path;<br>    this.flags = options.flags || &#x27;r&#x27;;<br>    this.encoding = options.encoding || null;<br>    this.highWaterMark = options.highWaterMark || 64*1024;<br>    this.mode = options.mode || 438;<br>    this.autoClose = options.autoClose || true;<br>    this.start = options.start || 0;<br>    this.end = options.end;<br><br>    this.flowing = null; // é»˜è®¤æ˜¯æš‚åœæ¨¡å¼<br>    this.offset = 0; // è¯»å–æ–‡ä»¶çš„åç§»é‡<br>    this.open(); // æ‰“å¼€æ–‡ä»¶ (å¼‚æ­¥)<br>    this.on(&#x27;newListener&#x27;,(type) =&gt; &#123;<br>    console.log(type);<br>     if(type === &#x27;data&#x27;) &#123;<br>      this.flowing = true;<br>      this.read();<br>     &#125;<br>    &#125;)<br>  &#125;<br>  read() &#123;<br>    console.log(this.fd);  // undefined<br>   &#125;<br>  open() &#123;<br>    fs.open(this.path, this.flags, (err,fd) =&gt;&#123;<br>      this.fd = fd;<br>      this.emit(&#x27;open&#x27;, this.fd);<br>    &#125;)<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>ä¸Šé¢çš„<a target="_blank" rel="noopener" href="http://nodejs.cn/api/events.html#events_event_newlistener">newListener</a>äº‹ä»¶,ä¸ºå…¶æ³¨å†Œç›‘å¬å™¨ï¼Œä¼šä¼ é€’äº‹ä»¶åç§°å’Œå¯¹è¦æ·»åŠ çš„ç›‘å¬å™¨çš„å¼•ç”¨ã€‚<br>typeæ‰“å°å†…å®¹å¦‚ä¸‹ï¼š<br><img src="/./newListener.png" srcset="/img/loading.gif" lazyload alt="newListener"></p>
<p>åœ¨æˆ‘ä»¬æ‰“å¼€æ–‡ä»¶è¦å¯¹å…¶è¿›è¡Œè¯»å–çš„æ—¶å€™ï¼Œå‘ç°æ–‡ä»¶æ‰“å¼€æ“ä½œæ˜¯å¼‚æ­¥çš„ï¼Œè€Œè¯»å–æ“ä½œæ˜¯åŒæ­¥çš„ã€‚æ–‡ä»¶è¿˜æ²¡æ‰“å¼€å°±å»è¯»å–æ˜¯ä¸å¾—è¡Œçš„ã€‚<br>æ‰€ä»¥åœ¨<code>read()</code>çš„æ—¶å€™ï¼Œthis.fdæ˜¯undefinedã€‚æˆ‘ä»¬ç°åœ¨è¦è§£å†³çš„å°±æ˜¯è®©<code>read()</code>æ¯”<code>open()</code>æ…¢ã€‚<br>process.nextTickæ˜¯ä¸è¡Œçš„ï¼Œå®ƒæŒ‡å®šçš„ä»»åŠ¡ä¼šå‘ç”Ÿåœ¨æ‰€æœ‰å¼‚æ­¥ä»»åŠ¡ä¹‹å‰ã€‚<br>è§£å†³æ–¹æ³•æ˜¯ç»™<code>read()</code>æ³¨å†Œä¸€ä¸ªopenç›‘å¬å™¨ï¼Œæ–‡ä»¶æè¿°ç¬¦è·å–åˆ°åè§¦å‘è¿™ä¸ªopenäº‹ä»¶ã€‚<br>ç„¶åå†å»å†æ¬¡è°ƒç”¨<code>read()</code>ï¼Œè¿™æ ·å°±èƒ½åœ¨<code>read()</code>é‡Œè·å–åˆ°this.fdã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">read() &#123;<br>    if(typeof this.fd !== &quot;number&quot;) &#123; // å› ä¸ºread æ¯”openå…ˆè°ƒç”¨<br>      return this.once(&#x27;open&#x27;, this.read); // å…ˆæŠŠreadæ–¹æ³•å­˜èµ·æ¥ï¼Œ ç­‰openåå†æ¬¡è°ƒç”¨ã€‚<br>    &#125;<br>    console.log(this.fd);<br>  &#125;<br>  open() &#123;<br>    fs.open(this.path, this.flags, (err,fd) =&gt;&#123;<br>      this.fd = fd;<br>      this.emit(&#x27;open&#x27;, this.fd);<br>    &#125;)<br>  &#125;<br></code></pre></div></td></tr></table></figure>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š<br><img src="/./fd.png" srcset="/img/loading.gif" lazyload alt="fd"></p>
<p>è¿™æ ·å°±èƒ½è·å–åˆ°æ–‡ä»¶æè¿°ç¬¦ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¿›è¡Œè¿ç»­è¯»çš„æ“ä½œï¼Œread()ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">read() &#123;<br>   if(typeof this.fd !== &quot;number&quot;) &#123; // å› ä¸ºread æ¯”openå…ˆè°ƒç”¨<br>     return this.once(&#x27;open&#x27;, this.read); // å…ˆæŠŠreadæ–¹æ³•å­˜èµ·æ¥ï¼Œ ç­‰openåå†æ¬¡è°ƒç”¨ã€‚<br>   &#125;<br>   let buffer = Buffer.alloc(this.highWaterMark); // æ¯æ¬¡è¯»å¤šå°‘ä¸ª<br><br>   fs.read(this.fd, buffer, 0, this.highWaterMark, this.offset, (err, bytesRead) =&gt; &#123;<br>     this.offset += bytesRead; // æ¯æ¬¡å¾€å‰èµ°<br>     if(bytesRead &gt; 0) &#123; //åˆ¤æ–­æ˜¯å¦è¯»å®Œ<br>     this.emit(&#x27;data&#x27;, buffer); // å¦‚æœè¯»å–åˆ°äº†å†…å®¹å°±è§¦å‘dataäº‹ä»¶<br>     this.read();<br>     &#125; else &#123;<br>       this.emit(&#x27;end&#x27;);<br>     &#125;<br>   &#125;)<br> &#125;<br></code></pre></div></td></tr></table></figure>
<p>fs.readçš„å„ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ï¼š<br><code>this.fd</code>: è¦æ“ä½œçš„æ–‡ä»¶æ ‡è¯†ç¬¦<br><code>buffer</code>: ç»™ä¸€ä¸ªå¤šå¤§çš„ç¼“å†²åŒº<br><code>0</code>ï¼šä»bufferä»€ä¹ˆä½ç½®å¼€å§‹å¡«è¿›å»<br><code>this.highWaterMark</code>ï¼š æ¯æ¬¡è¯»å¤šå°‘<br><code>this.offset</code>ï¼šæ¯æ¬¡å†™å…¥æ–‡ä»¶çš„åç§»é‡<br>ç„¶åæˆ‘ä»¬æ¯æ¬¡è¯»å–åˆ°æ•°æ®ï¼Œå°±å»è§¦å‘dataäº‹ä»¶ï¼Œç„¶åæŠŠè¯»åˆ°çš„bufferä¼ é€’å‡ºå»ã€‚å¦‚æœbytesReadå°äºæˆ–ç­‰äºé›¶ï¼Œè¡¨ç¤ºè¯»å®Œäº†ç›´æ¥è§¦å‘endäº‹ä»¶å°±å¯ä»¥äº†ã€‚<br>æˆ‘ä»¬è¿˜éœ€è¦è¿›ä¸€æ­¥å®Œå–„æˆ‘ä»¬çš„è¯»å–æ“ä½œã€‚æŠŠæˆ‘ä»¬çš„endå’Œstartå‚æ•°ç”¨ä¸Šï¼Œå¹¶ä¸”æ·»åŠ closeå’Œæ§åˆ¶æµçš„æ–¹æ³•ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">const EventEmitter = require(&#x27;events&#x27;);<br>const fs = require(&#x27;fs&#x27;);<br>class ReadStream extends EventEmitter&#123;<br>  constructor(path, options = &#123;&#125;) &#123;<br>    super();<br>    this.path = path;<br>    this.flags = options.flags || &#x27;r&#x27;;<br>    this.encoding = options.encoding || null;<br>    this.highWaterMark = options.highWaterMark || 64*1024;<br>    this.mode = options.mode || 438;<br>    this.autoClose = options.autoClose || true;<br>    this.start = options.start || 0;<br>    this.end = options.end;<br><br>    this.flowing = null; // é»˜è®¤æ˜¯æš‚åœæ¨¡å¼<br>    this.offset = 0; //åç§»é‡<br>    this.open(); // æ‰“å¼€æ–‡ä»¶ (å¼‚æ­¥)<br>    this.on(&#x27;newListener&#x27;,(type) =&gt; &#123;<br>     if(type === &#x27;data&#x27;) &#123;<br>      this.flowing = true;<br>      this.read();<br>     &#125;<br>    &#125;)<br>  &#125;<br>  read() &#123;<br>    if(typeof this.fd !== &quot;number&quot;) &#123; // å› ä¸ºread æ¯”openå…ˆè°ƒç”¨<br>      return this.once(&#x27;open&#x27;, this.read); // å…ˆæŠŠreadæ–¹æ³•å­˜èµ·æ¥ï¼Œ ç­‰openåå†æ¬¡è°ƒç”¨ã€‚<br>    &#125;<br><br>    let howMuchToRead = this.end<br>    ? Math.min(this.highWaterMark, this.end-this.start + 1 - this.offset)<br>    : this.highWaterMark;<br>    let buffer = Buffer.alloc(howMuchToRead);<br><br>    fs.read(this.fd, buffer, 0, howMuchToRead, this.offset, (err, bytesRead) =&gt; &#123;<br>      this.offset += bytesRead;<br>      if(bytesRead &gt; 0) &#123;<br>      this.emit(&#x27;data&#x27;, buffer); // å¦‚æœè¯»å–åˆ°äº†å†…å®¹å°±è§¦å‘dataäº‹ä»¶<br>      this.flowing &amp;&amp; this.read();<br>      &#125; else &#123;<br>        this.emit(&#x27;end&#x27;);<br>        this.close();<br>      &#125;<br>    &#125;)<br>  &#125;<br>  close() &#123;<br>    if(this.autoClose) &#123;<br>      fs.close(this.fd, () =&gt; &#123;<br>        this.emit(&#x27;close&#x27;);<br>      &#125;)<br>    &#125;<br>  &#125;<br>  open() &#123;<br>    fs.open(this.path, this.flags, (err,fd) =&gt;&#123;<br>      this.fd = fd;<br>      this.emit(&#x27;open&#x27;, this.fd);<br>    &#125;)<br>  &#125;<br>  pause() &#123;<br>    this.flowing = false;<br>  &#125;<br>  resume() &#123;<br>    this.flowing = true;<br>    this.read();<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>å¦‚æœæˆ‘ä»¬ä¼ äº†endå’Œstart,æˆ‘ä»¬å°±éœ€è¦ç®—å‡ºæ¯æ¬¡ä¸€å…±è¯»å‡ ä¸ªï¼Œé˜²æ­¢æœ€åä¸€æ¬¡è¯»å–çš„æ—¶å€™è¶…è¿‡endã€‚<br>ç„¶ååŠ ä¸Šæ§åˆ¶æµçš„æ–¹æ³•ã€‚è¿˜æœ‰æ¡ä»¶ã€‚æˆ‘ä»¬çš„å¯è¯»æµå°±å®Œæˆäº†ã€‚</p>
<h2 id="å¯å†™æµï¼ˆwriteStreamï¼‰"><a href="#å¯å†™æµï¼ˆwriteStreamï¼‰" class="headerlink" title="å¯å†™æµï¼ˆwriteStreamï¼‰"></a>å¯å†™æµï¼ˆwriteStreamï¼‰</h2><h3 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h3><p>å¯å†™æµæœ€ä¸»è¦çš„å°±æ˜¯ <code>write</code> å’Œ <code>end</code> äº‹ä»¶ï¼Œä¸€ä¸ªæ˜¯å†™å…¥æ“ä½œï¼Œä¸€ä¸ªæ˜¯å…³é—­æ“ä½œã€‚<br>æˆ‘ä»¬å…ˆæ¥å®ç°ä¸€ä¸ªå†™ä¸€ç‚¹ï¼Œç­‰å¾…å†™å®Œï¼Œå†æ¬¡è¿›è¡Œå†™çš„æ“ä½œã€‚è¿™æ ·å¯ä»¥èŠ‚çœå†…å­˜å ç”¨ã€‚<br>åˆ›å»ºä¸€ä¸ªwrite.js æ–‡ä»¶ç”¨æ¥å†™å…¥æˆ‘ä»¬çš„ä»£ç ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">let fs = require(&#x27;fs&#x27;);<br>let ws = fs.createWriteStream(&#x27;./1.txt&#x27;,&#123;<br>  highWaterMark:3 // é¢„è®¡å ç”¨çš„å†…å­˜<br>&#125;)<br>let index = 0;<br>function write() &#123;<br>  let flag = true;<br>  while(index &lt; 10 &amp;&amp; flag) &#123;<br>    flag = ws.write(index + &#x27;&#x27;); // è½¬æ¢æˆ String<br>    index++;<br>  &#125;<br>  if(index &gt; 9) &#123;<br>    ws.end(); // å…³é—­æ–‡ä»¶ å…³é—­å¯å†™æµ<br>  &#125;<br>&#125;<br>write();<br><br>ws.on(&#x27;drain&#x27;, function()&#123;<br>  console.log(&#x27;é¢„è®¡å†…å­˜æ»¡äº†&#x27;);<br>  write();<br>&#125;)<br></code></pre></div></td></tr></table></figure>
<p>highWaterMarkå‚æ•°è¡¨ç¤ºé¢„è®¡å ç”¨çš„å†…å­˜,é»˜è®¤ä¸º16K.<br>å…¶å†…éƒ¨åœ¨å†™å…¥çš„ä¸ªæ•°è¾¾åˆ°äº†ï¼Œä¸”é¢„è®¡çš„å¤§å°è¢«å†™å…¥åˆ°æ–‡ä»¶åæ¸…ç©ºäº†ï¼Œå°±ä¼šè§¦å‘<code>drain</code>äº‹ä»¶ï¼Œ<br>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨<code>drain</code>äº‹ä»¶é‡Œï¼Œå†æ¬¡è°ƒç”¨writeæ–¹æ³•ã€‚è¾“å‡ºå†…å®¹å¦‚ä¸‹ï¼š<br><img src="/./write1.png" srcset="/img/loading.gif" lazyload alt="write1"></p>
<p>ç”±äºæˆ‘ä»¬å†™å…¥10ä¸ªæ•°ï¼Œæ¯æ¬¡å†™3ä¸ªï¼Œæ‰€ä»¥drainè§¦å‘äº†3æ¬¡ã€‚</p>
<blockquote>
<p><strong>æ³¨æ„ï¼š<br>ç”±äºå†…éƒ¨ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™å†™å®Œçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨è°ƒç”¨endäº‹ä»¶ã€‚<br>å¯å†™æµå†™å…¥æ˜¯æ•°æ®åªèƒ½æ˜¯å­—ç¬¦ä¸²æˆ–è€…Bufferã€‚</strong></p>
</blockquote>
<h3 id="writeStream-js"><a href="#writeStream-js" class="headerlink" title="writeStream.js"></a>writeStream.js</h3><p>æ¥ä¸‹æ¥åˆ›å»ºè‡ªå·±çš„å¯å†™æµï¼Œåˆ›å»º<code>writeStream.js</code>æ–‡ä»¶,æ”¹å†™write.js å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">let fs = require(&#x27;fs&#x27;);<br>let WriteStream = require(&#x27;./writeStream&#x27;)<br>let ws = new WriteStream(&#x27;./1.txt&#x27;,&#123;<br>  highWaterMark:3,// é¢„æœŸå ç”¨å‡ ä¸ªå†…å­˜<br>  encoding:&#x27;utf8&#x27;,// å†™å…¥çš„ç¼–ç <br>  start:0, // ä»æ–‡ä»¶çš„ç¬¬0ä¸ªä½ç½®å¼€å§‹å†™å…¥<br>  mode:438,<br>  flags:&#x27;w&#x27; // é»˜è®¤æ“ä½œæ˜¯å¯å†™<br>&#125;)<br>let index = 0;<br>function write() &#123;<br>  let flag = true;<br>  while(index &lt; 10 &amp;&amp; flag) &#123;<br>    flag = ws.write(index + &#x27;&#x27;);<br>    console.log(flag)<br>    index++;<br>  &#125;<br>  if(index &gt; 9) &#123;<br>    ws.end(); // å…³é—­æ–‡ä»¶ å…³é—­å¯å†™æµ<br>  &#125;<br>&#125;<br>write();<br><br>ws.on(&#x27;drain&#x27;, function()&#123;<br>  console.log(&#x27;é¢„è®¡å†…å­˜æ»¡äº†&#x27;);<br>  write();<br>&#125;)<br>ws.on(&#x27;close&#x27;,function()&#123;<br>  console.log(&#x27;å…³é—­äº†æ–‡ä»¶&#x27;);<br>&#125;)<br></code></pre></div></td></tr></table></figure>

<p>åˆšå¼€å§‹çš„å†™æ³•è·Ÿå¯è¯»æµæ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬å¼•å…¥eventsæ¨¡å—ï¼Œç„¶åæŠŠå‚æ•°åœ¨æ„é€ å‡½æ•°ä¸­èµ‹å€¼ã€‚å¯è¯»æµä¸€åˆ›å»ºå°±å¯ä»¥è¿›è¡Œå†™çš„æ“ä½œï¼Œ<br>é‚£ä¹ˆå®ƒåœ¨åˆ›å»ºçš„æ—¶å€™è‚¯å®šæ˜¯æ‰“å¼€äº†çš„ï¼Œæ¥ä¸‹æ¥å…ˆåˆ›å»º open() write() end() æ–¹æ³•ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">const EventEmitter = require(&#x27;events&#x27;);<br>class WriteStream &#123;<br>  constructor(path, options = &#123;&#125;) &#123;<br>    super();<br>    this.path = path;<br>    this.highWaterMark = options.highWaterMark || 16 * 1024<br>    this.encoding = options.encoding || &#x27;utf8&#x27;;<br>    this.start = options.start || 0;<br>    this.mode = options.mode || 0o666;<br>    this.flags = options.flags || &#x27;w&#x27;;<br>    // å…ˆæ‰“å¼€æ–‡ä»¶<br>    this.open();<br>  &#125;<br>  open() &#123;<br><br>  &#125;<br>  write() &#123;<br><br>  &#125;<br>  end() &#123;<br>    <br>  &#125;<br>&#125;<br><br>module.exports = WriteStream;<br></code></pre></div></td></tr></table></figure>
<p>å…ˆå®Œå–„æˆ‘ä»¬çš„open()æ–¹æ³•ï¼Œç”¨æˆ·ä¼šåŒæ­¥è°ƒç”¨writeæ–¹æ³•ï¼Œåœ¨å–çš„æ—¶å€™å¹¶ä¸ä¸€å®šèƒ½å–åˆ°æ–‡ä»¶æ ‡è¯†ç¬¦ï¼Œè€Œä¸”ç”¨æˆ·è°ƒç”¨writeæ–¹æ³•æ—¶ï¼Œ<br>éœ€è¦å…ˆåˆ¤æ–­å½“å‰æ˜¯å¦æ­£åœ¨å†™å…¥ï¼Œå¦‚æœæ­£åœ¨å†™å…¥éœ€è¦å…ˆæ”¾åˆ°ç¼“å­˜ä¸­ï¼Œå¦‚æœä¸æ˜¯æ­£åœ¨å†™å…¥ï¼Œéœ€è¦çœŸæ­£çš„å†™å…¥æ–‡ä»¶å½“ä¸­ã€‚<br>æˆ‘ä»¬è¿˜éœ€è¦åˆ›å»ºå‡ ä¸ªå˜é‡ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">class WriteStream &#123;<br>  constructor(path, options = &#123;&#125;) &#123;<br>    super();<br>    this.path = path;<br>    this.highWaterMark = options.highWaterMark || 16 * 1024<br>    this.encoding = options.encoding || &#x27;utf8&#x27;;<br>    this.start = options.start || 0;<br>    this.mode = options.mode || 0o666;<br>    this.flags = options.flags || &#x27;w&#x27;;<br>    // å…ˆæ‰“å¼€æ–‡ä»¶<br>    this.open();<br>    // ç¼“å­˜åŒº <br>    this.cache = [];<br>    this.writing = false; // åˆ¤æ–­æ˜¯å¦æ­£åœ¨è¢«å†™å…¥<br>    this.len = 0; // ç¼“å­˜åŒºçš„å¤§å°<br>    this.needDrain = false; // æ˜¯å¦è§¦å‘drainäº‹ä»¶<br>    this.offset = this.start; // offset è¡¨ç¤ºæ¯æ¬¡å†™å…¥çš„åç§»é‡<br>  &#125;<br>  open() &#123; // å…ˆæ‰“å¼€æ–‡ä»¶<br>    fs.open(this.path, this.flags, (err, fd) =&gt; &#123;<br>      this.fd = fd;<br>      this.emit(&#x27;open&#x27;, fd);<br>    &#125;)<br>  &#125;<br>  write() &#123;<br><br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>æ¥ä¸‹æ¥å®Œå–„writeæ–¹æ³•,ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å†™å…¥çš„æ•°æ®ï¼Œç¬¬äºŒä¸ªæ˜¯ç¼–ç æ²¡ç»™ç”¨é»˜è®¤çš„ç¼–ç ï¼Œç¬¬ä¸‰ä¸ªæ˜¯ä¸ªcallbackã€‚<br>æˆ‘ä»¬é¦–å…ˆè¦å…ˆåˆ¤æ–­ï¼Œå†™å…¥çš„æ•°æ®æ˜¯ä¸æ˜¯buffer,å¦‚æœä¸æ˜¯è½¬æ¢æˆbufferã€‚æ¥ç€ç»Ÿè®¡å†™å…¥æ•°æ®çš„ä¸ªæ•°ï¼Œ<br>ç„¶åå’ŒhighWaterMarkæ¯”è¾ƒï¼Œè¿”å›ä¸€ä¸ªflagã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">write(chunk, encoding = this.encoding, callback) &#123;// ç”¨æˆ·ä¼šåŒæ­¥çš„è°ƒç”¨writeæ–¹æ³•<br>   chunk = Buffer.isBuffer(chunk) ? chunk : Buffer.from(chunk); // åˆ¤æ–­è¿™ä¸ªchunk æ˜¯ä¸æ˜¯buffer å¦‚æœä¸æ˜¯bufferè½¬åŒ–æˆbuffer<br>   this.len += chunk.length; // ç»Ÿè®¡å†™å…¥æ•°æ®çš„ä¸ªæ•°<br>   let flag = this.len &lt; this.highWaterMark;<br>   return flag;<br> &#125;<br></code></pre></div></td></tr></table></figure>
<p>è¿è¡Œwrite.jsæ–‡ä»¶ï¼Œè¾“å‡º:</p>
<blockquote>
<p>true<br>true<br>false</p>
</blockquote>
<p>è¿™æ ·å­æ˜¯æ²¡é”™çš„ï¼Œflagè¿”å›çš„æ˜¯å‘ŠçŸ¥è¿˜æœ‰æ²¡æœ‰ç©ºé—´ï¼Œæˆ‘ä»¬çš„highWaterMarkä¼ å…¥çš„æ˜¯3ï¼Œæ‰€ä»¥ç¬¬ä¸‰ä¸ªå†™å…¥æ»¡äº†ï¼Œå°±è¿”å›äº†falseã€‚<br>è¿™æ ·æˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œä»€ä¹ˆæ—¶å€™åº”è¯¥è§¦å‘drainäº‹ä»¶ã€‚ç„¶åæˆ‘ä»¬éœ€è¦å°†é™¤äº†ç¬¬ä¸€æ¬¡æ•°æ®çœŸå®å†™å…¥ï¼Œè€Œå…¶ä»–éƒ½æ”¾åˆ°ç¼“å­˜ä¸­ã€‚<br>ç„¶åå†å»æ¸…ç©ºç¼“å­˜é˜Ÿåˆ—ï¼Œæ¯æ¬¡å–ç¬¬ä¸€ä¸ªï¼Œè¿›è¡ŒçœŸæ­£çš„å†™å…¥ã€‚è€Œä¸”æ¯æ¬¡è°ƒç”¨çš„æ—¶å€™ï¼Œè¿˜éœ€è¦æ‰§è¡Œè‡ªå·±çš„æˆåŠŸæ“ä½œï¼Œå¹¶ä¸”æ¸…ç©ºé˜Ÿåˆ—ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">write(chunk, encoding = this.encoding, callback) &#123;// ç”¨æˆ·ä¼šåŒæ­¥çš„è°ƒç”¨writeæ–¹æ³•<br>   chunk = Buffer.isBuffer(chunk) ? chunk : Buffer.from(chunk); // åˆ¤æ–­è¿™ä¸ªchunk æ˜¯ä¸æ˜¯buffer å¦‚æœä¸æ˜¯bufferè½¬åŒ–æˆbuffer<br>   this.len += chunk.length; // ç»Ÿè®¡å†™å…¥æ•°æ®çš„ä¸ªæ•°<br>   let flag = this.len &lt; this.highWaterMark;<br>   this.needDrain = !flag; //ç›¸åæ“ä½œ<br>   if (this.writing) &#123; // å½“å‰æ˜¯å¦æ­£åœ¨å†™å…¥<br>     this.cache.push(&#123; // å°†é™¤äº†ç¬¬ä¸€æ¬¡çœŸå®çš„å†™å…¥ï¼Œå…¶ä»–éƒ½æ”¾åˆ°ç¼“å­˜ä¸­<br>       chunk,<br>       encoding,<br>       callback<br>     &#125;)<br>   &#125; else &#123;<br>     this.writing = true; // æ ‡è¯†æ˜¯å¦æ­£åœ¨å†™å…¥<br>     this._write(chunk, encoding, () =&gt; &#123;<br>       callback &amp;&amp; callback(); // å…ˆæ‰§è¡Œè‡ªå·±çš„æˆåŠŸæ“ä½œ<br>       this.clearBuffer(); // å†å»æ¸…ç©ºé˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ª<br>     &#125;);// çœŸå®åƒæ–‡ä»¶ä¸­å†™å…¥<br>   &#125;<br>   return flag;<br> &#125;<br></code></pre></div></td></tr></table></figure>
<p>æˆ‘ä»¬å…ˆæ¥åˆ›å»ºçœŸæ­£å†™å…¥çš„æ ¸å¿ƒæ–¹æ³•_write,å®ƒè·å–this.fdï¼Œéœ€è¦ç­‰å¾…openäº‹ä»¶è§¦å‘ï¼Œè·Ÿå¯è¯»æµä¸€æ ·ã€‚<br>æ¥ç€è¿›è¡Œæ–‡ä»¶çš„å†™å…¥æ“ä½œ:</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">// æ ¸å¿ƒçš„å†™å…¥æ–¹æ³•<br>_write(chunk, encoding, clearBuffer) &#123;<br>  if (typeof this.fd !== &#x27;number&#x27;) &#123; //  writeæ–¹æ³•ç›¸å¯¹äºopen æ˜¯å…ˆè°ƒç”¨çš„<br>    return this.once(&#x27;open&#x27;, () =&gt; this._write(chunk, encoding, clearBuffer))<br>  &#125;<br>  fs.write(this.fd, chunk, 0, chunk.length, this.offset, (err, written) =&gt; &#123;<br>    // written è¡¨ç¤ºçœŸå®å†™å…¥çš„ä¸ªæ•°<br>    this.offset += written; // å¢åŠ åç§»é‡<br>    this.len -= written; // å‡å°‘ç¼“å­˜ä¸­çš„æ•°æ®<br>    clearBuffer(); // æ¸…ç©ºç¼“å­˜<br>  &#125;)<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>fs.writeçš„å„ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ï¼š<br><code>this.fd</code>: è¦æ“ä½œçš„æ–‡ä»¶æ ‡è¯†ç¬¦<br><code>chunk</code>: å†™å…¥çš„æ•°æ®<br><code>chunk.length</code>: è¯»å–bufferå¤šå°‘ä¸ªå­—èŠ‚<br><code>0</code>ï¼š0è¡¨ç¤ºæŠŠæ•°æ®çš„ç¬¬0ä¸ªä½ç½®å¼€å§‹å†™å…¥<br><code>this.highWaterMark</code>ï¼š æ¯æ¬¡è¯»å¤šå°‘<br><code>this.offset</code>ï¼šæ¯æ¬¡å†™å…¥æ–‡ä»¶çš„åç§»é‡<br>æ¥ä¸‹æ¥è¦å†™æ¸…ç©ºç¼“å­˜ä¸­çš„æ–¹æ³•ï¼Œéœ€è¦åˆ¤æ–­ç¼“å­˜ä¸­æ˜¯å¦æœ‰æ•°æ®ï¼Œå¦‚æœæœ‰å°±å–å‡ºç¬¬ä¸€ä¸ªè¿›è¡Œå†™å…¥ï¼Œå¦‚æœæ²¡æœ‰æ•°æ®ä¸”this.needDrainä¸ºtrueï¼Œ<br>å°±è¡¨ç¤ºæ•°æ®éƒ½è¢«æ¸…ç©ºäº†ï¼Œéœ€è¦ä»æ–°è®¾ç½®å˜é‡ç„¶åè§¦å‘drainäº‹ä»¶ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">clearBuffer() &#123;<br>   // å»ç¼“å­˜ä¸­å–<br>   let obj = this.cache.shift();<br>   if (obj) &#123; // éœ€è¦å†™å…¥<br>     this._write(obj.chunk, obj.encoding, () =&gt; &#123;<br>       obj.callback &amp;&amp; obj.callback();<br>       this.clearBuffer();<br>     &#125;);<br>   &#125; else &#123;<br>     if (this.needDrain) &#123;<br>       this.needDrain = false; // ä¸‹ä¸€æ¬¡éœ€è¦é‡æ–°åˆ¤æ–­æ˜¯å¦éœ€è¦è§¦å‘drainäº‹ä»¶<br>       this.writing = false; //å‘Šè¯‰ä¸‹ä¸€æ¬¡è°ƒç”¨write åº”è¯¥åƒæ–‡ä»¶ä¸­å†™å…¥<br>       this.emit(&#x27;drain&#x27;);<br>     &#125;<br>   &#125;<br> &#125;<br></code></pre></div></td></tr></table></figure>
<p>è¿™æ ·æˆ‘ä»¬çš„å†™å…¥æ–¹æ³•å°±å®Œæˆäº†ï¼Œå†åˆ°write.jsé‡Œrunä¸€ä¸‹ï¼Œå†…å®¹æ˜¯æ­£ç¡®çš„ï¼Œæœ€åè¿˜éœ€è¦å®Œå–„closeå’Œendæ–¹æ³•ã€‚<br>closeæ¯”è¾ƒç®€å•ç›´æ¥è°ƒç”¨fsçš„closeæ–¹æ³•å°±è¡Œäº†ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">close() &#123;<br>  fs.close(this.fd, () =&gt; &#123;<br>    this.emit(&#x27;close&#x27;)<br>  &#125;)<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>æ¥ç€å°±æ˜¯endæ–¹æ³•ï¼Œendæ–¹æ³•å¯ä»¥ä¼ å‚ï¼Œç¬¬ä¸€ä¸ªæ˜¯å†™å…¥çš„å†…å®¹ï¼Œç¬¬äºŒä¸ªæ˜¯ç¼–ç ï¼Œ<br>å¦‚æœä¼ é€’å‚æ•°ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå¼ºåˆ¶æ¸…ç©ºç¼“å­˜ï¼Œç„¶åå†™å…¥endæ–¹æ³•çš„å†…å®¹ï¼Œæ¥ç€å†å…³é—­æ–‡ä»¶,ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">end(chunk, encoding) &#123;  <br>  if (chunk) &#123;<br>    chunk = Buffer.isBuffer(chunk)?chunk:Buffer.from(chunk);<br>    return this.write(chunk, encoding, () =&gt; &#123;<br>      this.close()<br>    &#125;)<br>  &#125;<br>  this.close();<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>è¿™æ ·æˆ‘ä»¬å°±å®Œæˆäº†å¯å†™æµã€‚</p>
<h3 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h3><p>é”™è¯¯ä¹‹å¤„ç•™è¨€å‘ŠçŸ¥ï¼Œè°¢è°¢ä½ ï¼ã€‚</p>
<p>è®°å¾—é‡‘éŠ®åŒå”±ç¬¬ï¼Œæ˜¥é£ä¸Šå›½ç¹åã€‚<br>ã€Œä¸´æ±Ÿä»™Â·è®°å¾—é‡‘éŠ®åŒå”±ç¬¬ã€<br>æ¬§é˜³ä¿®</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/node-js/">node.js</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2020/04/07/%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84koa/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">å®ç°ç®€å•çš„koa</span>
                        <span class="visible-mobile">Vorheriger</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2020/03/13/%E5%9C%A8node%E4%B8%AD%E4%BD%BF%E7%94%A8RabbitMQ/">
                        <span class="hidden-mobile">win10ç¯å¢ƒåœ¨nodeä¸­ä½¿ç”¨RabbitMQ</span>
                        <span class="visible-mobile">NÃ¤chster</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      var light = 'github-light';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'waterbang/Comment');
      s.setAttribute('issue-term', 'pathname');
      
      s.setAttribute('label', 'utterances');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Suchen</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">Stichwort</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a>
  </div>
  

  
  <!-- å¤‡æ¡ˆä¿¡æ¯ -->
  <div class="beian">
    <span>
      <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
        é—½ICPå¤‡18009949å·-2
      </a>
    </span>
    
  </div>


  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>












  
    <!-- Baidu Analytics -->
    <script defer>
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?58e161bf4b884b2aa577f323f137ac0f";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  

  

  

  

  

  





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ ä¿æŒåœ¨æœ€åº•éƒ¨ -->
<script  src="/js/boot.js" ></script>


</body>
</html>
