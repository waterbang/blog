

<!DOCTYPE html>
<html lang="ch_CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="waterbang">
  <meta name="keywords" content="waterbang">
  
    <meta name="description" content="å‰è¨€æ³¨æ„ï¼šæœ¬ç¯‡å†…å®¹ä»¥å®˜æ–¹æ–‡æ¡£ä¸ºä¸»çº¿åŠ ä¸ªäººç†è§£å’Œé‡‡å‘ å®‰è£…RabbitMQåœ¨windows10ä¸Šå®‰è£…æ³¨æ„ï¼šå®‰è£…RabbitMQè¦å…ˆå®‰è£…Erlangç¼–ç¨‹è¯­è¨€ã€‚éœ€è¦ç¿»å¢™ä¸‹è½½ï¼Œä¸ç„¶å¾ˆæ…¢ã€‚  https:&#x2F;&#x2F;www.erlang.org&#x2F;downloads  å®‰è£…å®Œéœ€è¦è®¾ç½®ç³»ç»Ÿå˜é‡ã€‚ å¯ä»¥ä»github ä¸Šä¸‹è½½ï¼š https:&#x2F;&#x2F;github.com&#x2F;rabbitmq&#x2F;rabbitmq-server&#x2F;rel">
<meta property="og:type" content="article">
<meta property="og:title" content="win10ç¯å¢ƒåœ¨nodeä¸­ä½¿ç”¨RabbitMQ">
<meta property="og:url" content="https://www.waterbang.top/2020/03/13/%E5%9C%A8node%E4%B8%AD%E4%BD%BF%E7%94%A8RabbitMQ/index.html">
<meta property="og:site_name" content="waterbang">
<meta property="og:description" content="å‰è¨€æ³¨æ„ï¼šæœ¬ç¯‡å†…å®¹ä»¥å®˜æ–¹æ–‡æ¡£ä¸ºä¸»çº¿åŠ ä¸ªäººç†è§£å’Œé‡‡å‘ å®‰è£…RabbitMQåœ¨windows10ä¸Šå®‰è£…æ³¨æ„ï¼šå®‰è£…RabbitMQè¦å…ˆå®‰è£…Erlangç¼–ç¨‹è¯­è¨€ã€‚éœ€è¦ç¿»å¢™ä¸‹è½½ï¼Œä¸ç„¶å¾ˆæ…¢ã€‚  https:&#x2F;&#x2F;www.erlang.org&#x2F;downloads  å®‰è£…å®Œéœ€è¦è®¾ç½®ç³»ç»Ÿå˜é‡ã€‚ å¯ä»¥ä»github ä¸Šä¸‹è½½ï¼š https:&#x2F;&#x2F;github.com&#x2F;rabbitmq&#x2F;rabbitmq-server&#x2F;rel">
<meta property="og:locale" content="ch_CN">
<meta property="og:image" content="https://www.waterbang.top/2020/03/13/%E5%9C%A8node%E4%B8%AD%E4%BD%BF%E7%94%A8RabbitMQ/login.png">
<meta property="article:published_time" content="2020-03-13T13:39:54.000Z">
<meta property="article:modified_time" content="2024-12-21T11:43:23.163Z">
<meta property="article:author" content="waterbang">
<meta property="article:tag" content="node.js">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://www.waterbang.top/2020/03/13/%E5%9C%A8node%E4%B8%AD%E4%BD%BF%E7%94%A8RabbitMQ/login.png">
  
  
  <title>win10ç¯å¢ƒåœ¨nodeä¸­ä½¿ç”¨RabbitMQ ğŸ® waterbang</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/atom-one-dark.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"www.waterbang.top","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":"ğŸ¦"},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":"58e161bf4b884b2aa577f323f137ac0f","google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>waterbang</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Startseite
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archiv
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Etiketten
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                Ãœber mich
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                Weblinks
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/post-banner.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="win10ç¯å¢ƒåœ¨nodeä¸­ä½¿ç”¨RabbitMQ">
              
            </span>

            
              <div class="mt-3">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-author" aria-hidden="true"></i>
      waterbang
    </span>
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2020-03-13 21:39" pubdate>
        March 13, 2020 pm
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      11k å­—
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      96 åˆ†é’Ÿ
    </span>
  

  
  
    
      <!-- ä¸è’œå­ç»Ÿè®¡æ–‡ç« PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> æ¬¡
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">win10ç¯å¢ƒåœ¨nodeä¸­ä½¿ç”¨RabbitMQ</h1>
            
              <p class="note note-info">
                
                  æœ¬æ–‡æœ€åæ›´æ–°äºï¼š5 hours ago
                
              </p>
            
            <div class="markdown-body">
              <h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p><strong>æ³¨æ„ï¼šæœ¬ç¯‡å†…å®¹ä»¥å®˜æ–¹æ–‡æ¡£ä¸ºä¸»çº¿åŠ ä¸ªäººç†è§£å’Œé‡‡å‘</strong></p>
<h2 id="å®‰è£…RabbitMQ"><a href="#å®‰è£…RabbitMQ" class="headerlink" title="å®‰è£…RabbitMQ"></a>å®‰è£…RabbitMQ</h2><h3 id="åœ¨windows10ä¸Šå®‰è£…"><a href="#åœ¨windows10ä¸Šå®‰è£…" class="headerlink" title="åœ¨windows10ä¸Šå®‰è£…"></a>åœ¨windows10ä¸Šå®‰è£…</h3><p>æ³¨æ„ï¼šå®‰è£…RabbitMQè¦å…ˆå®‰è£…<code>Erlang</code>ç¼–ç¨‹è¯­è¨€ã€‚éœ€è¦ç¿»å¢™ä¸‹è½½ï¼Œä¸ç„¶å¾ˆæ…¢ã€‚</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.erlang.org/downloads">https://www.erlang.org/downloads</a></p>
</blockquote>
<p>å®‰è£…å®Œéœ€è¦è®¾ç½®ç³»ç»Ÿå˜é‡ã€‚</p>
<h4 id="å¯ä»¥ä»github-ä¸Šä¸‹è½½ï¼š"><a href="#å¯ä»¥ä»github-ä¸Šä¸‹è½½ï¼š" class="headerlink" title="å¯ä»¥ä»github ä¸Šä¸‹è½½ï¼š"></a>å¯ä»¥ä»github ä¸Šä¸‹è½½ï¼š</h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/rabbitmq/rabbitmq-server/releases">https://github.com/rabbitmq/rabbitmq-server/releases</a></p>
</blockquote>
<h5 id="æˆ–è€…ç‚¹å‡»ç›´æ¥ä¸‹è½½"><a href="#æˆ–è€…ç‚¹å‡»ç›´æ¥ä¸‹è½½" class="headerlink" title="æˆ–è€…ç‚¹å‡»ç›´æ¥ä¸‹è½½"></a>æˆ–è€…ç‚¹å‡»ç›´æ¥ä¸‹è½½</h5><p>æ³¨æ„ï¼šè¿™ä¸ªé“¾æ¥åœ¨æ‚¨åˆ°æ¥ä¹‹åå¯èƒ½ä¸æ˜¯æœ€æ–°ç‰ˆï¼<br><a target="_blank" rel="noopener" href="https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.8.3/rabbitmq-server-3.8.3.exe">https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.8.3/rabbitmq-server-3.8.3.exe</a></p>
<h4 id="ä½¿ç”¨-chocolatey-Windowsä¸‹çš„è½¯ä»¶åŒ…ç®¡ç†å™¨"><a href="#ä½¿ç”¨-chocolatey-Windowsä¸‹çš„è½¯ä»¶åŒ…ç®¡ç†å™¨" class="headerlink" title="ä½¿ç”¨ chocolatey(Windowsä¸‹çš„è½¯ä»¶åŒ…ç®¡ç†å™¨)"></a>ä½¿ç”¨ <code>chocolatey</code>(Windowsä¸‹çš„è½¯ä»¶åŒ…ç®¡ç†å™¨)</h4><p>è¦å®‰è£…RabbitMQï¼Œè¯·åœ¨å‘½ä»¤è¡Œæˆ–PowerShellä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤:</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">choco install rabbitmq<br></code></pre></div></td></tr></table></figure>

<h3 id="åœ¨MacOSä¸Šä¸‹è½½"><a href="#åœ¨MacOSä¸Šä¸‹è½½" class="headerlink" title="åœ¨MacOSä¸Šä¸‹è½½"></a>åœ¨MacOSä¸Šä¸‹è½½</h3><p>ç¡®ä¿ Homebrew ä¸ºæœ€æ–°çš„ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">brew update<br></code></pre></div></td></tr></table></figure>

<p>ç„¶åä¸‹è½½rabbitmq</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">brew install rabbitmq<br></code></pre></div></td></tr></table></figure>

<h4 id="ä¹Ÿå¯ä»¥ä¸‹è½½é€šç”¨UNIXçš„äºŒè¿›åˆ¶æ–‡ä»¶"><a href="#ä¹Ÿå¯ä»¥ä¸‹è½½é€šç”¨UNIXçš„äºŒè¿›åˆ¶æ–‡ä»¶" class="headerlink" title="ä¹Ÿå¯ä»¥ä¸‹è½½é€šç”¨UNIXçš„äºŒè¿›åˆ¶æ–‡ä»¶"></a>ä¹Ÿå¯ä»¥ä¸‹è½½é€šç”¨UNIXçš„äºŒè¿›åˆ¶æ–‡ä»¶</h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.8.3/rabbitmq-server-generic-unix-3.8.3.tar.xz">https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.8.3/rabbitmq-server-generic-unix-3.8.3.tar.xz</a></p>
</blockquote>
<h3 id="ä½¿ç”¨dockeré•œåƒ"><a href="#ä½¿ç”¨dockeré•œåƒ" class="headerlink" title="ä½¿ç”¨dockeré•œåƒ"></a>ä½¿ç”¨dockeré•œåƒ</h3><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">docker pull rabbitmq<br></code></pre></div></td></tr></table></figure>
<br>

<h3 id="é…ç½®RabbitMQ"><a href="#é…ç½®RabbitMQ" class="headerlink" title="é…ç½®RabbitMQ"></a>é…ç½®RabbitMQ</h3><p><strong>æ³¨æ„ï¼šæ¥ä¸‹æ¥ä»¥windows10ä¸ºåŸºæœ¬ç¯å¢ƒ</strong><br>å¦‚æœæ‚¨çš„ç¯å¢ƒä¸ºwin10,ä¸‹è½½å®Œæˆè®°å¾—å°†RabbitMQçš„<code>/sbin</code>ç›®å½•åŠ å…¥ç³»ç»Ÿç¯å¢ƒã€‚<br>ä»¥ä¾¿åœ¨ä»»ä½•åœ°æ–¹æ§åˆ¶æ‚¨çš„MQ.<br>è¿è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">rabbitmqctl status<br></code></pre></div></td></tr></table></figure>
<h4 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h4><p>æˆ‘çš„RabbitMQä¸€å¯åŠ¨å°±å¤±è´¥ï¼Œç³»ç»Ÿæ—¥å¿—æ˜¾ç¤ºäº†ä»¥ä¸‹é”™è¯¯ã€‚</p>
<blockquote>
<p>RabbitMQ: Erlang machine stopped instantly (distribution name conflict?). The service is not restarted, ignoring OnFail option.</p>
</blockquote>
<p>æˆ‘å°è¯•äº†å¤šç§è§£å†³æ–¹å¼ã€‚ä½†æ˜¯éƒ½æ²¡æœ‰ç”¨ï¼Œæœ€åæŠŠ<code>erlang</code>å’Œ<code>RabbitMQ</code>å¸è½½æ‰ï¼Œéƒ½æ¢æˆæœ€æ–°ç‰ˆæœ¬è§£å†³äº†é—®é¢˜ã€‚<br>æ³¨æ„ï¼š</p>
<ol>
<li>RabbitMQæ— æ³•å®‰è£…åˆ°å…·æœ‰ASCIIå­—ç¬¦çš„è·¯å¾„,ä¹Ÿå°±æ˜¯è·¯å¾„ä¸èƒ½æœ‰ä¸­æ–‡</li>
<li>éœ€è¦ç”¨ç®¡ç†å‘˜èº«ä»½å®‰è£…Erlangç¯å¢ƒã€‚</li>
<li>å®‰è£…è·¯å¾„ä¸è¦æœ‰ç©ºæ ¼ã€‚ï¼ˆæœªå®è·µï¼ï¼‰<br>å®˜æ–¹å¯¹é”™è¯¯çš„è§£ç­”ï¼š<a target="_blank" rel="noopener" href="https://www.rabbitmq.com/windows-quirks.html">Windowsæ€ªç™–</a></li>
</ol>
<h4 id="å®‰è£…å¯è§†åŒ–æ’ä»¶"><a href="#å®‰è£…å¯è§†åŒ–æ’ä»¶" class="headerlink" title="å®‰è£…å¯è§†åŒ–æ’ä»¶"></a>å®‰è£…å¯è§†åŒ–æ’ä»¶</h4><p>å…ˆæŸ¥çœ‹RabbitMQçš„å…¨éƒ¨æ’ä»¶ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">rabbitmq-plugins list<br></code></pre></div></td></tr></table></figure>
<p>è¾“å‡ºå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">Listing plugins with pattern &quot;.*&quot; ...<br> Configured: E = explicitly enabled; e = implicitly enabled<br> | Status: [failed to contact rabbit@waterbang - status not shown]<br> |/<br>....<br>[  ] rabbitmq_federation_management    3.8.3<br>[  ] rabbitmq_jms_topic_exchange       3.8.3<br>[  ] rabbitmq_management               3.8.3 // è¿™ä¸ªæ˜¯æˆ‘ä»¬è¦å®‰è£…çš„ç®¡ç†æ’ä»¶<br>[  ] rabbitmq_management_agent         3.8.3<br>[  ] rabbitmq_mqtt                     3.8.3<br>[  ] rabbitmq_peer_discovery_aws       3.8.3<br>[  ] rabbitmq_peer_discovery_common    3.8.3<br>[  ] rabbitmq_peer_discovery_consul    3.8.3<br>[  ] rabbitmq_peer_discovery_etcd      3.8.3<br>[  ] rabbitmq_peer_discovery_k8s       3.8.3<br>...<br></code></pre></div></td></tr></table></figure>
<p>è¿è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">rabbitmq-plugins enable rabbitmq_management<br></code></pre></div></td></tr></table></figure>
<p>è¾“å‡ºä»¥ä¸‹å†…å®¹ä¸ºå®‰è£…æˆåŠŸ</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">Enabling plugins on node rabbit@waterbang:<br>rabbitmq_management<br>The following plugins have been configured:<br>  rabbitmq_management<br>  rabbitmq_management_agent<br>  rabbitmq_web_dispatch<br>Applying plugin configuration to rabbit@waterbang...<br>The following plugins have been enabled:<br>  rabbitmq_management<br>  rabbitmq_management_agent<br>  rabbitmq_web_dispatch<br><br>set 3 plugins.<br>Offline change; changes will take effect at broker restart.<br></code></pre></div></td></tr></table></figure>


<h2 id="å¦‚ä½•åœ¨nodeä¸­ä¼ é€’æ¶ˆæ¯"><a href="#å¦‚ä½•åœ¨nodeä¸­ä¼ é€’æ¶ˆæ¯" class="headerlink" title="å¦‚ä½•åœ¨nodeä¸­ä¼ é€’æ¶ˆæ¯"></a>å¦‚ä½•åœ¨nodeä¸­ä¼ é€’æ¶ˆæ¯</h2><p>æˆ‘ä»¬æ¥è·Ÿç€å®˜æ–¹çš„å…¥é—¨ä¾‹å­æ¥è¿›è¡Œç¬¬ä¸€æ­¥ï¼Œå°†ç”Ÿäº§è€…è¿æ¥åˆ°RabbitMQ,å‘é€ä¸€æ¡æ¶ˆæ¯åé€€å‡ºã€‚<br>ä¸‹é¢æ˜¯æˆ‘ä»¬è¦å®ç°çš„åŸºæœ¬æ¨¡å‹ã€‚ä¸­é—´è“è‰²çš„é˜Ÿåˆ—æ˜¯æ¶ˆæ¯ç¼“å†²åŒºã€‚<br><img src="/./helloword.png" srcset="/img/loading.gif" lazyload alt="hello world"></p>
<h3 id="å®‰è£…amqp-node"><a href="#å®‰è£…amqp-node" class="headerlink" title="å®‰è£…amqp.node"></a>å®‰è£…amqp.node</h3><p><code>amqplib</code>æ˜¯ä¸€ä¸ªä¸ºNode.JSåˆ¶ä½œ<a target="_blank" rel="noopener" href="https://www.rabbitmq.com/amqp-0-9-1-reference.html">AMQP 0-9-1</a>å®¢æˆ·ç«¯çš„åº“ï¼Œå®ƒæ”¯æŒCallbackå’ŒPromiseä¸¤ç§é£æ ¼ã€‚<br>æ¥ä¸‹æ¥åœ¨æ‚¨çš„å·¥ä½œç›®å½•è¿è¡Œï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">npm install amqplib<br></code></pre></div></td></tr></table></figure>

<h3 id="ç”Ÿäº§è€…"><a href="#ç”Ÿäº§è€…" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h3><p>å®‰è£…å®Œæˆåå¼€å§‹å†™ä»£ç ã€‚åˆ›å»ºç”Ÿäº§è€…send.jsã€‚å…ˆè¿æ¥é“RabbitMQæœåŠ¡å™¨ï¼Œ<br>è¿™æ˜¯RabbitMQç»™æˆ‘ä»¬çš„ä¸€ä¸ªæœ€é‡è¦çš„æ¥å£ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">var amqp = require(&#x27;amqplib&#x27;);<br><br>amqp.connect(&#x27;amqp://localhost:5672&#x27;).then((conn) =&gt; &#123;  // åˆ›å»ºä¸€ä¸ªé€šé“<br>  console.log(conn);<br>&#125;, (err) =&gt; &#123;<br>  throw Error(&#x27;connection fail:===&gt;&#x27; + err);<br>&#125;)<br></code></pre></div></td></tr></table></figure>
<p>å®ƒè¿”å›ç»™æˆ‘ä»¬ä¸€ä¸ªChannelModelã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨å®ƒæ¥åˆ›å»ºä¸€ä¸ªé€šé“,å¹¶ä¸”ç”¨<code>assertQueue(queue,[options])</code>å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—ã€‚<br>å®ƒæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š<br><code>queue</code>æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼›å¦‚æœæ‚¨æä¾›ä¸€ä¸ªç©ºå­—ç¬¦ä¸²æˆ–å…¶ä»–è™šå‡å€¼ï¼ˆåŒ…æ‹¬nullå’Œundefinedï¼‰ï¼Œåˆ™æœåŠ¡å™¨å°†ä¸ºæ‚¨åˆ›å»ºä¸€ä¸ªéšæœºåç§°ã€‚<br><code>options</code>æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥ä¸ºç©ºæˆ–nullï¼Œå¦‚æœæ˜¯æœ€åä¸€ä¸ªå‚æ•°ï¼Œåˆ™å¯ä»¥å®Œå…¨çœç•¥ã€‚<br>é€‰é¡¹ä¸­çš„ç›¸å…³å­—æ®µæ˜¯ï¼š</p>
<ol>
<li>exclusiveï¼šå¦‚æœä¸ºtrueï¼Œåˆ™å°†é˜Ÿåˆ—çš„ä½œç”¨åŸŸé™å®šä¸ºè¿æ¥ï¼ˆé»˜è®¤ä¸ºfalseï¼‰</li>
<li>durableï¼šå¦‚æœä¸ºtrueï¼Œåˆ™é˜Ÿåˆ—å°†åœ¨ä»£ç†é‡æ–°å¯åŠ¨åå¹¸å­˜ä¸‹æ¥ï¼Œå¹¶å¯¹exclusiveå’Œçš„ä½œç”¨å–æ¨¡autoDeleteã€‚å¦‚æœæœªæä¾›ï¼Œåˆ™é»˜è®¤ä¸ºtrueï¼Œè¿™ä¸å…¶ä»–æ–¹æ³•ä¸åŒ</li>
<li>autoDeleteï¼šå¦‚æœä¸ºtrueï¼Œåˆ™å½“ä½¿ç”¨è€…æ•°é‡é™è‡³é›¶ï¼ˆé»˜è®¤å€¼ä¸ºfalseï¼‰æ—¶ï¼Œå°†åˆ é™¤é˜Ÿåˆ—ã€‚</li>
<li>argumentsï¼šé™„åŠ å‚æ•°ï¼Œé€šå¸¸æ˜¯æŸç§ç‰¹å®šäºä»£ç†çš„æ‰©å±•çš„å‚æ•°ï¼Œä¾‹å¦‚ï¼Œé«˜å¯ç”¨æ€§ï¼ŒTTLã€‚<br>*æƒ³è¦äº†è§£å¾—æ›´åŠ è¯¦ç»†<a target="_blank" rel="noopener" href="https://www.squaremobius.net/amqp.node/channel_api.html#channel_assertQueue">ç‚¹æˆ‘</a>*ï¼Œä»£ç å¦‚ä¸‹ï¼š</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">var amqp = require(&#x27;amqplib&#x27;);<br><br>amqp.connect(&#x27;amqp://localhost:5672&#x27;).then((conn) =&gt; &#123;  // è¿æ¥åˆ°RabbitMQæœåŠ¡å™¨<br>  return conn.createChannel().then((ch) =&gt; &#123; // åˆ›å»ºä¸€ä¸ªé€šé“<br>    console.log(ch);<br>    let q = &#x27;Queue&#x27;; // é˜Ÿåˆ—åç§°<br>    let msg = &#x27;How are you!&#x27;; // å‘é€çš„æ¶ˆæ¯<br>    let ok = ch.assertQueue(q, &#123; durable: false &#125;); // åˆ›å»ºé˜Ÿåˆ—<br>  &#125;).finally(() =&gt; &#123;<br>    conn.close();<br>  &#125;);<br>&#125;, (err) =&gt; &#123;<br>  throw Error(&#x27;connection fail:===&gt;&#x27; + err);<br>&#125;)<br></code></pre></div></td></tr></table></figure>
<p>å®ƒè¿”å›ç»™æˆ‘ä»¬ä¸€ä¸ªChannelï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—.<br>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">var amqp = require(&#x27;amqplib&#x27;);<br><br>amqp.connect(&#x27;amqp://localhost:5672&#x27;).then((conn) =&gt; &#123;  // è¿æ¥åˆ°RabbitMQ<br>  return conn.createChannel().then((ch) =&gt; &#123; // åˆ›å»ºä¸€ä¸ªé€šé“<br>    let q = &#x27;Queue&#x27;;<br>    let msg = &#x27;How are you!&#x27;;<br>    let ok = ch.assertQueue(q, &#123; durable: false &#125;); // å£°æ˜é˜Ÿåˆ—<br><br>    return ok.then((_qok) =&gt; &#123;<br>       for (let i = 0; i &lt; 100; i++) &#123;<br>            ch.sendToQueue(q, Buffer.from(`$&#123;msg&#125; ç¬¬$&#123;i&#125;æ¡æ¶ˆæ¯`));<br>        &#125;<br>      console.log(&quot; [x] Sent &#x27;%s&#x27;&quot;, msg);<br>      return ch.close(); // å…³é—­é€šé“<br>    &#125;)<br>  &#125;).finally(() =&gt; &#123;<br>    conn.close();<br>  &#125;);<br>&#125;, (err) =&gt; &#123;<br>  throw Error(&#x27;connection fail:===&gt;&#x27; + err);<br>&#125;)<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p>APIè¯¦è§£<a target="_blank" rel="noopener" href="https://www.squaremobius.net/amqp.node/channel_api.html#channel_sendToQueue">sendToQueue</a><br>Buffer.from() :åˆ›å»ºä¸€ä¸ªæ–°ç¼“å†²åŒºï¼Œå…¶ä¸­å¡«å……äº†æŒ‡å®šçš„å­—ç¬¦ä¸²</p>
</blockquote>
<h3 id="æ¶ˆè´¹è€…"><a href="#æ¶ˆè´¹è€…" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h3><p>æ¥ä¸‹æˆ‘ä»¬æ¥è·Ÿç€ä¸Šé¢ä¸€æ ·å†™å‡ºæ¶ˆè´¹è€…çš„ä»£ç ï¼Œæˆ‘ä»¬å°†ä½¿æ¶ˆè´¹è€…ä¿æŒè¿è¡ŒçŠ¶æ€ä»¥ç›‘å¬æ¶ˆæ¯å¹¶æ‰“å°å‡ºæ¥ã€‚<br>æˆ‘ä»¬ä¸€æ ·è¦åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—ï¼Œé˜²æ­¢åœ¨æ²¡æœ‰è¿è¡Œç”Ÿäº§è€…çš„æ—¶å€™è¿è¡Œæ¶ˆè´¹è€…ã€‚<br>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">var amqp = require(&#x27;amqplib&#x27;);<br><br>amqp.connect(&#x27;amqp://localhost:5672&#x27;).then((conn) =&gt; &#123; // è¿æ¥åˆ°RabbitMQ<br>  process.once(&#x27;SIGINT&#x27;, () =&gt; &#123; conn.close(); &#125;); // ï¼ˆbeforeExitï¼‰åœ¨é€€å‡ºä¹‹å‰,å…³é—­é€šé“ã€‚<br><br>  return conn.createChannel().then((ch) =&gt; &#123; // åˆ›å»ºé€šé“<br>    let queue = &#x27;Queue&#x27;;<br>    let ok = ch.assertQueue(queue, &#123;durable: false&#125;);  // åˆ›å»ºé˜Ÿåˆ—ï¼Œï¼ˆå…³é—­æŒä¹…åŒ–ï¼‰<br><br>    ok = ok.then(function(_qok) &#123;<br>      return ch.consume(queue, (msg) =&gt; &#123;  // å–å‡ºæ¶ˆæ¯ï¼ˆæ¶ˆè´¹ï¼‰<br>        console.log(&quot; [x] æ¶ˆè´¹äº† &#x27;%s&#x27;&quot;, msg.content.toString());<br>      &#125;, &#123;noAck: true&#125;);<br>    &#125;);<br><br>    return ok.then((_consumeOk) =&gt; &#123;<br>      console.log(&#x27; [*] Waiting for messages. To exit press CTRL+C&#x27;);<br>    &#125;);<br>  &#125;);<br>&#125;).catch(console.warn);<br></code></pre></div></td></tr></table></figure>
<p><code>noAck: true</code>ï¼Œå¦‚æœä¸ºtrueï¼Œè¡¨ç¤ºå½“æ¶ˆè´¹è€…æ”¶åˆ°æ¶ˆæ¯ä¸ä¼šé€šçŸ¥RabbitMQï¼Œæ¶ˆè´¹è€…æ”¶åˆ°äº†æ¶ˆæ¯å°±ä¼šç«‹å³ä»é˜Ÿåˆ—ä¸­åˆ é™¤ã€‚</p>
<blockquote>
<p>æ¶ˆè´¹API -&gt; <a target="_blank" rel="noopener" href="https://www.squaremobius.net/amqp.node/channel_api.html#channel_consume">consume</a></p>
</blockquote>
<p>è¿™æ ·å°±å®ç°äº†åŸºæœ¬çš„æ¶ˆæ¯å‘é€å’Œæ¥æ”¶ã€‚</p>
<h2 id="ä»»åŠ¡é˜Ÿåˆ—"><a href="#ä»»åŠ¡é˜Ÿåˆ—" class="headerlink" title="ä»»åŠ¡é˜Ÿåˆ—"></a>ä»»åŠ¡é˜Ÿåˆ—</h2><p>ä½¿ç”¨ä»»åŠ¡é˜Ÿåˆ—çš„ä¼˜ç‚¹ä¹‹ä¸€æ˜¯èƒ½å¤Ÿè½»æ¾å¹¶è¡ŒåŒ–å·¥ä½œã€‚å¦‚æœæˆ‘ä»¬æœ‰å¾ˆå¤šå·¥ä½œï¼Œæˆ‘ä»¬å¯ä»¥å¢åŠ æ›´å¤šçš„æ¶ˆè´¹è€…ï¼Œè¿™æ ·å°±å¯ä»¥è½»æ¾æ‰©å±•ã€‚<br>æˆ‘ä»¬å…ˆæ¥ä¿®æ”¹ä¸€ä¸‹ä¸Šé¢send.jsçš„ä»£ç ï¼Œè®©å®ƒèƒ½åœ¨å‘½ä»¤è¡Œæ¥æ”¶æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">var amqp = require(&#x27;amqplib&#x27;);<br><br>amqp.connect(&#x27;amqp://localhost:5672&#x27;).then((conn) =&gt; &#123;  // åˆ›å»ºä¸€ä¸ªé€šé“<br>  return conn.createChannel().then((ch) =&gt; &#123;<br>    let q = &#x27;task_queue&#x27;;<br>    let msg = process.argv.slice(2).join(&#x27;&#x27;) || &#x27;helloWord!&#x27;;<br>    let ok = ch.assertQueue(q, &#123; durable: true &#125;);<br><br>    return ok.then((_qok) =&gt; &#123;<br>        ch.sendToQueue(q, Buffer.from(msg), &#123;<br>          persistent: true<br>        &#125;);<br>      console.log(&quot; [x] Sent &#x27;%s&#x27;&quot;, msg);<br>      return ch.close();<br>    &#125;)<br>  &#125;).finally(() =&gt; &#123;<br>    conn.close();<br>  &#125;);<br>&#125;, (err) =&gt; &#123;<br>  throw Error(&#x27;connection fail:===&gt;&#x27; + err);<br>&#125;)<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p><code>persistent: true</code>å¦‚æœæ˜¯trueï¼Œåˆ™æ¶ˆæ¯å°†åœ¨ä»£ç†é‡æ–°å¯åŠ¨åç»§ç»­å­˜åœ¨ï¼Œå‰ææ˜¯å®ƒåœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œè¯¥é˜Ÿåˆ—ä¹Ÿåœ¨é‡æ–°å¯åŠ¨åç»§ç»­å­˜åœ¨.</p>
</blockquote>
<p>æ¥ä¸‹æ¥ä¿®æ”¹ä¸€ä¸‹ä¸Šé¢çš„receive.jsï¼Œè®©å®ƒåœ¨å¤„ç†æ¶ˆæ¯çš„æ—¶å€™ä¼ªé€ ä¸€ç§’é’Ÿçš„åœé¡¿ã€‚<br>å®ƒå°†ä»é˜Ÿåˆ—ä¸­å¼¹å‡ºæ¶ˆæ¯å¹¶æ‰§è¡Œä»»åŠ¡ï¼Œæˆ‘ä»¬å°†å…¶å‘½åä¸º<code>worker.js</code>ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">var amqp = require(&#x27;amqplib&#x27;);<br><br>amqp.connect(&#x27;amqp://localhost:5672&#x27;).then((conn) =&gt; &#123;<br>  process.once(&#x27;SIGINT&#x27;, () =&gt; &#123; conn.close(); &#125;); //beforeExit æ‰§è¡Œcloseã€‚<br>  return conn.createChannel().then((ch) =&gt; &#123;<br>    let queue = &#x27;task_queue&#x27;; // ä¿è¯ä½¿ç”¨è¯¥é˜Ÿåˆ—çš„æ—¶å€™å…ˆå£°æ˜è¯¥é˜Ÿåˆ—<br>    let ok = ch.assertQueue(queue, &#123;durable: true&#125;);<br><br>    ok = ok.then(function(_qok) &#123;<br>      return ch.consume(queue, (msg) =&gt; &#123;<br>        let secs = msg.content.toString().split(&#x27;.&#x27;).length - 1; //å‡ ä¸ªç‚¹å°±å»¶è¿Ÿå‡ ç§’<br>         console.log(&quot; [x] Received %s&quot;, msg.content.toString());<br>         setTimeout(function() &#123;<br>           console.log(&quot; [x] Done&quot;);<br>         &#125;, secs * 1000);<br>      &#125;, &#123;noAck: true&#125;);<br>    &#125;);<br><br>    return ok.then((_consumeOk) =&gt; &#123;<br>      console.log(&#x27; [*] Waiting for messages. To exit press CTRL+C&#x27;);<br>    &#125;);<br>  &#125;);<br>&#125;).catch(console.warn);<br></code></pre></div></td></tr></table></figure>

<h3 id="å¾ªç¯è°ƒåº¦"><a href="#å¾ªç¯è°ƒåº¦" class="headerlink" title="å¾ªç¯è°ƒåº¦"></a>å¾ªç¯è°ƒåº¦</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒRabbitMQå°†æŒ‰é¡ºåºå°†æ¯ä¸ªæ¶ˆæ¯å‘é€ç»™ä¸‹ä¸€ä¸ªä½¿ç”¨è€…ã€‚<br>å¹³å‡è€Œè¨€ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…éƒ½ä¼šæ”¶åˆ°ç›¸åŒæ•°é‡çš„æ¶ˆæ¯ã€‚è¿™ç§åˆ†å‘æ¶ˆæ¯çš„æ–¹å¼ç§°ä¸ºå¾ªç¯ã€‚<br>å…·ä½“æ•ˆæœå¦‚ä¸‹ï¼š<br><img src="/./TaskQueue.png" srcset="/img/loading.gif" lazyload alt="TaskQueue"></p>
<h3 id="æ¶ˆæ¯ç¡®è®¤"><a href="#æ¶ˆæ¯ç¡®è®¤" class="headerlink" title="æ¶ˆæ¯ç¡®è®¤"></a>æ¶ˆæ¯ç¡®è®¤</h3><p>å¦‚æœå…¶ä¸­ä¸€ä¸ªä½¿ç”¨è€…å¼€å§‹ä¸€é¡¹æ¼«é•¿çš„ä»»åŠ¡å¹¶ä»…éƒ¨åˆ†å®Œæˆè€Œæ­»æ‰ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µã€‚<br>ä½¿ç”¨æˆ‘ä»¬å½“å‰çš„ä»£ç ï¼ŒRabbitMQä¸€æ—¦å‘æ¶ˆè´¹è€…å‘é€äº†ä¸€æ¡æ¶ˆæ¯ï¼Œä¾¿ç«‹å³å°†å…¶æ ‡è®°ä¸ºåˆ é™¤ã€‚<br>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæ‚¨æ€æ­»ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œæˆ‘ä»¬å°†ä¸¢å¤±æ­£åœ¨å¤„ç†çš„æ¶ˆæ¯ã€‚æˆ‘ä»¬è¿˜å°†ä¸¢å¤±æ‰€æœ‰å‘é€ç»™è¯¥ç‰¹å®šæ¶ˆè´¹è€…ä½†å°šæœªå¤„ç†çš„æ¶ˆæ¯ã€‚<br>ä½†æ˜¯æˆ‘ä»¬ä¸æƒ³ä¸¢å¤±ä»»ä½•ä»»åŠ¡ã€‚å¦‚æœä¸€ä¸ªæ¶ˆè´¹è€…æ­»äº¡ï¼Œæˆ‘ä»¬å¸Œæœ›å°†ä»»åŠ¡äº¤ä»˜ç»™å¦ä¸€ä¸ªæ¶ˆè´¹è€…ã€‚<br>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥ä¿®æ”¹ä¸€ä¸‹ä»£ç ï¼Œå¼€å¯<code>&#123;noAck: false&#125;</code>é€‰é¡¹ï¼Œä¸€æ—¦æˆ‘ä»¬å®Œæˆäº†ä¸€é¡¹ä»»åŠ¡ï¼Œæ¶ˆè´¹è€…ä¼šå‘é€ä¸€ä¸ªç¡®è®¤æ¶ˆæ¯ã€‚<br>ä¿®æ”¹worker.js,å…·ä½“å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">var amqp = require(&#x27;amqplib&#x27;);<br><br>amqp.connect(&#x27;amqp://localhost:5672&#x27;).then((conn) =&gt; &#123;<br>  process.once(&#x27;SIGINT&#x27;, () =&gt; &#123; conn.close(); &#125;); //beforeExit æ‰§è¡Œcloseã€‚<br><br>  return conn.createChannel().then((ch) =&gt; &#123;<br>    let queue = &#x27;task_queue&#x27;; // ä¿è¯ä½¿ç”¨è¯¥é˜Ÿåˆ—çš„æ—¶å€™å…ˆå£°æ˜è¯¥é˜Ÿåˆ—<br>    let ok = ch.assertQueue(queue, &#123;durable: true&#125;);<br>    ok = ok.then(function(_qok) &#123;<br><br>      return ch.consume(queue, (msg) =&gt; &#123;<br>        let secs = msg.content.toString().split(&#x27;.&#x27;).length - 1;<br>         console.log(&quot; [x] Received %s&quot;, msg.content.toString());<br>         setTimeout(function() &#123;<br>           console.log(&quot; [x] Done&quot;);<br>           ch.ack(msg);  // ++  // ç¡®è®¤ç»™å®šçš„æ¶ˆæ¯<br>         &#125;, secs * 1000);<br>      &#125;, &#123;noAck: false&#125;); // == <br>    &#125;);<br><br>    return ok.then((_consumeOk) =&gt; &#123;<br>      console.log(&#x27; [*] Waiting for messages. To exit press CTRL+C&#x27;);<br>    &#125;);<br>  &#125;);<br>&#125;).catch(console.warn);<br></code></pre></div></td></tr></table></figure>
<p>è¿™æ ·å°±èƒ½é˜²æ­¢æ¶ˆè´¹è€…æŒ‚æ‰åï¼Œç”±å®ƒå¤„ç†çš„ä»»åŠ¡å¤±è´¥æ‰ï¼Œæˆ‘ä»¬æ¥æ•…æ„æŒ‚æ‰æ¶ˆè´¹è€…1å·ï¼Œå…·ä½“æ•ˆæœå¦‚ä¸‹ï¼š<br><img src="/./TaskQueue_out.png" srcset="/img/loading.gif" lazyload alt="TaskQueue_out.png"></p>
<p>æ¶ˆè´¹è€…æŒ‚æ‰åï¼Œæœªç¡®è®¤çš„æ¶ˆæ¯è¢«é‡å‘äº†ã€‚</p>
<h3 id="æ¶ˆæ¯æŒä¹…åŒ–"><a href="#æ¶ˆæ¯æŒä¹…åŒ–" class="headerlink" title="æ¶ˆæ¯æŒä¹…åŒ–"></a>æ¶ˆæ¯æŒä¹…åŒ–</h3><p>æˆ‘ä»¬å·²ç»å®ç°äº†å¦‚ä½•ç¡®ä¿æ¶ˆè´¹è€…æ­»äº¡ï¼Œä»»åŠ¡ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚ä½†æ˜¯ï¼Œå¦‚æœRabbitMQæœåŠ¡å™¨åœæ­¢ï¼Œæˆ‘ä»¬çš„ä»»åŠ¡ä»ç„¶ä¼šä¸¢å¤±ã€‚<br>å¦‚æœæ‚¨è¦å‘ŠçŸ¥RabbitMQ,ç¡®ä¿æ¶ˆæ¯ä¸ä¼šæ¶ˆå¤±ï¼Œéœ€è¦åšä¸¤ä»¶äº‹ï¼šæˆ‘ä»¬éœ€è¦å°†é˜Ÿåˆ—å’Œæ¶ˆæ¯éƒ½æ ‡è®°ä¸ŠæŒä¹…æ€§ã€‚<br>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿RabbitMQæ°¸è¿œä¸ä¼šä¸¢å¤±é˜Ÿåˆ—ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶å£°æ˜ä¸ºæŒä¹…çš„ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">channel.assertQueue(&#x27;hello&#x27;, &#123;durable: true&#125;);<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„ï¼šRabbitMQä¸å…è®¸æ‚¨ä½¿ç”¨ä¸åŒçš„å‚æ•°é‡æ–°å®šä¹‰ç°æœ‰é˜Ÿåˆ—ï¼Œå¹¶ä¸”å°†å‘å°è¯•æ‰§è¡Œæ­¤æ“ä½œçš„ä»»ä½•ç¨‹åºè¿”å›é”™è¯¯ã€‚</p>
</blockquote>
<p>æ¥ä¸‹æ¥å°†æ¶ˆæ¯æ ‡è®°ä¸ºæŒä¹…æ¶ˆæ¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">channel.sendToQueue(queueï¼ŒBuffer.from(msg)ï¼Œ&#123; persistentï¼štrue &#125;);<br></code></pre></div></td></tr></table></figure>

<p>æ¶ˆæ¯æŒä¹…åŒ–å¹¶ä¸ä¼šçœŸæ­£çš„å†™å…¥ç£ç›˜ï¼Œå®ƒåªæ˜¯ä¿å­˜åˆ°ç¼“å­˜å½“ä¸­ï¼ŒæŒä¹…æ€§å¹¶ä¸å¼ºï¼Œä½†å¯¹äºç®€å•é˜Ÿåˆ—è€Œè¨€ï¼Œå·²ç»ç»°ç»°æœ‰ä½™äº†ã€‚<br>å¦‚æœè¿˜éœ€è¦æ›´å¼ºçš„ä¿å­˜èƒ½åŠ›ï¼Œå¯ä»¥ä½¿ç”¨<a target="_blank" rel="noopener" href="https://www.rabbitmq.com/confirms.html">å‘å¸ƒè€…ç¡®è®¤</a></p>
<h3 id="å…¬å¹³åˆ†é…"><a href="#å…¬å¹³åˆ†é…" class="headerlink" title="å…¬å¹³åˆ†é…"></a>å…¬å¹³åˆ†é…</h3><p>ä¸ºäº†ä¸è®©RabbitMQç›²ç›®çš„å°†æ¶ˆæ¯çš„ç¬¬næ¡æ¶ˆæ¯å‘é€ç»™ç¬¬nä¸ªä½¿ç”¨è€…ã€‚è¿™æ ·åœ¨æœ‰çš„ä»»åŠ¡é‡ï¼Œæœ‰çš„ä»»åŠ¡è½»çš„æ—¶å€™ï¼Œ<br>å¯èƒ½ä¼šå‡ºç°ä¸€ä½å·¥äººå°†ä¸€ç›´å¿™ç¢Œè€Œå¦ä¸€ä½å·¥äººå°†å‡ ä¹ä¸åšä»»ä½•å·¥ä½œã€‚<br>å‘ç”Ÿè¿™ç§æƒ…å†µæ˜¯å› ä¸ºRabbitMQåœ¨æ¶ˆæ¯è¿›å…¥é˜Ÿåˆ—æ—¶æ‰è°ƒåº¦æ¶ˆæ¯ã€‚å®ƒä¸ä¼šæŸ¥çœ‹æ¶ˆè´¹è€…çš„æœªç¡®è®¤æ¶ˆæ¯æ•°ã€‚<br>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜æˆ‘ä»¬éœ€è¦åšä»¥ä¸‹é…ç½®ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">channel.prefetch(1);<br></code></pre></div></td></tr></table></figure>
<p>åœ¨å¤„ç†å¹¶ç¡®è®¤ä¸Šä¸€æ¡æ¶ˆæ¯ä¹‹å‰ï¼Œä¸è¦å°†æ–°æ¶ˆæ¯å‘é€ç»™å·¥ä½œäººå‘˜ã€‚è€Œæ˜¯å°†å…¶åˆ†æ´¾ç»™å°šä¸ç¹å¿™çš„ä¸‹ä¸€ä¸ªå·¥ä½œäººå‘˜ã€‚</p>
<h2 id="å‘å¸ƒè®¢é˜…"><a href="#å‘å¸ƒè®¢é˜…" class="headerlink" title="å‘å¸ƒè®¢é˜…"></a>å‘å¸ƒè®¢é˜…</h2><p>ä¸Šé¢æˆ‘ä»¬å®ç°äº†æŠŠæ¯ä¸ªä»»åŠ¡æ°å¥½äº¤ä»˜ç»™ä¸€ä¸ªå·¥äººï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥å®ç°ï¼Œå°†æ¶ˆæ¯ä¼ é€’ç»™å¤šä¸ªå·¥äººã€‚<br>æˆ‘ä»¬æ¥è·Ÿç€å®˜æ–¹çš„ä¾‹å­ï¼Œæ„å»ºä¸€ä¸ªç®€å•çš„æ—¥å¿—è®°å½•ç³»ç»Ÿã€‚å°±æ˜¯å°†å·²å‘å¸ƒçš„æ—¥å¿—å¹¿æ’­åˆ°æ‰€æœ‰æ¥æ”¶è€…ã€‚<br>å®ƒç”±ä¸¤ä¸ªç¨‹åºç»„æˆï¼šç¬¬ä¸€ä¸ªç¨‹åºå°†å‘å‡ºæ—¥å¿—æ¶ˆæ¯ï¼Œç¬¬äºŒä¸ªç¨‹åºå°†æ¥æ”¶å¹¶æ‰“å°å®ƒä»¬ã€‚</p>
<h3 id="äº¤æ¢ï¼ˆExchangesï¼‰"><a href="#äº¤æ¢ï¼ˆExchangesï¼‰" class="headerlink" title="äº¤æ¢ï¼ˆExchangesï¼‰"></a>äº¤æ¢ï¼ˆExchangesï¼‰</h3><p>å®ƒæ˜¯Rabbitçš„æ¶ˆæ¯äº¤æ¢æ¨¡å‹ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯ç”Ÿäº§è€…ä»ä¸å°†ä»»ä½•æ¶ˆæ¯ç›´æ¥å‘é€åˆ°é˜Ÿåˆ—ã€‚<br>ä¸€æ–¹é¢ï¼Œå®ƒæ¥æ”¶æ¥è‡ªç”Ÿäº§è€…çš„æ¶ˆæ¯ï¼Œå¦ä¸€æ–¹é¢ï¼Œå°†å®ƒä»¬æ¨å…¥é˜Ÿåˆ—ã€‚<br>ä½†æ˜¯å®ƒå¦‚ä½•çŸ¥é“åº”è¯¥å°†æ¶ˆæ¯åŠ å…¥é˜Ÿåˆ—ï¼Œè¿˜æ˜¯ä¸¢å¼ƒå‘¢ï¼Ÿè§„åˆ™ç”±äº¤æ¢ç±»å‹å®šä¹‰ã€‚<br>æœ‰å››ç§äº¤æ¢ç±»å‹å¯ç”¨ï¼š<code>direct</code>,<code>topic</code>,<code>headers</code>,<code>fanout</code>ã€‚<br><code>fanout</code>äº¤æ¢ç±»å‹æ­£æ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼Œå®ƒåªæ˜¯å°†æ¥æ”¶åˆ°çš„æ‰€æœ‰æ¶ˆæ¯å¹¿æ’­åˆ°å®ƒçŸ¥é“çš„æ‰€æœ‰é˜Ÿåˆ—ä¸­ã€‚</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">ch.assertExchange(&#x27;logs&#x27;,&#x27;fanout&#x27;,&#123;durableï¼šfalse &#125;)<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p>Channelçš„<code>assertExchange</code>ç”¨æ¥æ–­è¨€äº¤æ¢çš„å­˜åœ¨ï¼Œä¸é˜Ÿåˆ—ä¸€æ ·ã€‚<br>å‚æ•°ç±»å‹ä¸ºï¼šassertExchange(exchange, type, [options])</p>
</blockquote>
<p>å¦‚æœè¦çŸ¥é“æ‚¨çš„æœåŠ¡å™¨ä¸Šçš„äº¤æ¢å¯ä»¥è¿è¡Œï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">rabbitmqctl list_exchanges<br></code></pre></div></td></tr></table></figure>

<h4 id="é»˜è®¤äº¤æ¢"><a href="#é»˜è®¤äº¤æ¢" class="headerlink" title="é»˜è®¤äº¤æ¢"></a>é»˜è®¤äº¤æ¢</h4><p>æˆ‘ä»¬ä»¥å‰ä½¿ç”¨çš„éƒ½æ˜¯é»˜è®¤äº¤æ¢</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">channel.sendToQueue(&#x27;hello&#x27;ï¼ŒBuffer.from(&#x27;Hello Worldï¼&#x27;));<br></code></pre></div></td></tr></table></figure>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨é»˜è®¤æˆ–æ— åç§°äº¤æ¢ï¼šæ¶ˆæ¯ä»¥æŒ‡å®šä¸ºç¬¬ä¸€ä¸ªå‚æ•°çš„åç§°è·¯ç”±åˆ°é˜Ÿåˆ—ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚<br>æ¥ä¸‹æ¥æˆ‘ä»¬æŒ‡å®šå‘å¸ƒåˆ°<code>logs</code>äº¤æ¢ä¸­ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">channel.publish(&#x27;logs&#x27;, &#x27;&#x27;, Buffer.from(&#x27;Hello Worldï¼&#x27;));<br></code></pre></div></td></tr></table></figure>
<p><code>publish</code>åŠŸèƒ½å’Œ<code>sendToQueue</code>å·®ä¸å¤šï¼Œç¬¬äºŒä¸ªå‚æ•°çš„ç©ºå­—ç¬¦ä¸²è¡¨ç¤ºæˆ‘ä»¬ä¸æƒ³å°†æ¶ˆæ¯å‘é€åˆ°ä»»ä½•ç‰¹å®šçš„é˜Ÿåˆ—ã€‚</p>
<h3 id="ç»‘å®š"><a href="#ç»‘å®š" class="headerlink" title="ç»‘å®š"></a>ç»‘å®š</h3><p>æˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ª<code>fanout</code>äº¤æ¢å’Œä¸€ä¸ªé˜Ÿåˆ—ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦å‘Šè¯‰äº¤æ¢æœºå°†æ¶ˆæ¯å‘é€åˆ°æˆ‘ä»¬çš„é˜Ÿåˆ—ã€‚äº¤æ¢å’Œé˜Ÿåˆ—ä¹‹é—´çš„å…³ç³»ç§°ä¸ºç»‘å®šã€‚</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs HTML">channel.bindQueue(queue_name, &#x27;logs&#x27;, &#x27;&#x27;);<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.squaremobius.net/amqp.node/channel_api.html#channel_bindQueue">bindQueue</a>:å£°æ˜ä»äº¤æ¢æœºåˆ°é˜Ÿåˆ—çš„è·¯ç”±è·¯å¾„</p>
</blockquote>
<p>è¿™æ­¤æˆ‘ä»¬å°†æ¶ˆæ¯å‘é€åˆ°<code>logs</code>äº¤æ¢å™¨ï¼Œè€Œä¸æ˜¯æ— åçš„é»˜è®¤äº¤æ¢å™¨ã€‚<br>å‘é€æ—¶æˆ‘ä»¬éœ€è¦æä¾›ä¸€ä¸ªè·¯ç”±å¯†é’¥ï¼Œä½†æ˜¯å¯¹äº<code>fanout</code>äº¤æ¢ï¼Œå®ƒçš„å€¼å°†è¢«å¿½ç•¥ã€‚è¿™æ˜¯emit_log.jsè„šæœ¬çš„ä»£ç  ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">const amqp = require(&#x27;amqplib&#x27;);<br><br>amqp.connect(&#x27;amqp://localhost&#x27;).then((conn) =&gt; &#123;<br>  return conn.createChannel().then((ch) =&gt; &#123;<br>    const ex = &#x27;logs&#x27;;<br>    let ok = ch.assertExchange(ex, &#x27;fanout&#x27;, &#123;durable: false&#125;) // å£°æ˜äº¤æ¢<br><br>    let message = process.argv.slice(2).join(&#x27; &#x27;) ||<br>      &#x27;info: Hello World!&#x27;;<br><br>    return ok.then(() =&gt; &#123;<br>      ch.publish(ex, &#x27;&#x27;, Buffer.from(message));<br>      console.log(&quot; [x] Sent &#x27;%s&#x27;&quot;, message);<br>      return ch.close();<br>    &#125;);<br>  &#125;).finally(() =&gt; &#123; conn.close(); &#125;);<br>&#125;).catch(console.warn);<br></code></pre></div></td></tr></table></figure>
<p>ä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå»ºç«‹è¿æ¥ä¹‹åï¼Œæˆ‘ä»¬å£°æ˜äº†äº¤æ¢ã€‚<br>å¦‚æœæ²¡æœ‰é˜Ÿåˆ—ç»‘å®šåˆ°å¯¹åº”çš„äº¤æ¢é‚£ä¹ˆæ¶ˆæ¯å°†ä¸¢å¤±ã€‚receive_log.jsä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">const amqp = require(&#x27;amqplib&#x27;);<br><br>amqp.connect(&#x27;amqp://localhost&#x27;).then( (conn) =&gt; &#123;<br>  process.once(&#x27;SIGINT&#x27;, () =&gt; &#123; conn.close(); &#125;);<br>  return conn.createChannel().then((ch) =&gt; &#123;<br>    let ok = ch.assertExchange(&#x27;logs&#x27;, &#x27;fanout&#x27;, &#123; durable: false &#125;);<br>    ok = ok.then(() =&gt; &#123;<br>      return ch.assertQueue(&#x27;&#x27;, &#123; exclusive: true &#125;);<br>    &#125;);<br>    ok = ok.then((qok) =&gt; &#123;<br>      return ch.bindQueue(qok.queue, &#x27;logs&#x27;, &#x27;&#x27;).then(function () &#123;  // ç»‘å®šé˜Ÿåˆ—<br>        return qok.queue;<br>      &#125;);<br>    &#125;);<br>    ok = ok.then((queue) =&gt; &#123;<br>      return ch.consume(queue, logMessage, &#123; noAck: true &#125;);<br>    &#125;);<br>    return ok.then(() =&gt; &#123;<br>      console.log(&#x27; [*] Waiting for logs. To exit press CTRL+C&#x27;);<br>    &#125;);<br><br>    function logMessage(msg) &#123;<br>      console.log(&quot; [x] &#x27;%s&#x27;&quot;, msg.content.toString());<br>    &#125;<br>  &#125;);<br>&#125;).catch(console.warn);<br></code></pre></div></td></tr></table></figure>
<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š<br><img src="/./fady.png" srcset="/img/loading.gif" lazyload alt="fady"></p>
<h2 id="over"><a href="#over" class="headerlink" title="over"></a>over</h2><p>åŠ©ç§‹é£é›¨æ¥ä½•é€Ÿï¼ŒæƒŠç ´ç§‹çª—ç§‹æ¢¦ç»¿ã€‚<br>ã€Œä»£åˆ«ç¦»Â·ç§‹çª—é£é›¨å¤•ã€<br>æ›¹é›ªèŠ¹</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/node-js/">node.js</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2020/03/29/%E5%9F%BA%E4%BA%8Enode%E7%9A%84fs%E5%AE%9E%E7%8E%B0%E5%8F%AF%E8%AF%BB%E6%B5%81%E5%92%8C%E5%8F%AF%E5%86%99%E6%B5%81/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">åŸºäºnodeçš„fså®ç°å¯è¯»æµå’Œå¯å†™æµ</span>
                        <span class="visible-mobile">Vorheriger</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2020/03/10/node%E4%B8%AD%E7%9A%84require%E6%96%B9%E6%B3%95/">
                        <span class="hidden-mobile">nodeä¸­çš„requireæ–¹æ³•</span>
                        <span class="visible-mobile">NÃ¤chster</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      var light = 'github-light';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'waterbang/Comment');
      s.setAttribute('issue-term', 'pathname');
      
      s.setAttribute('label', 'utterances');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Suchen</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">Stichwort</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a>
  </div>
  

  
  <!-- å¤‡æ¡ˆä¿¡æ¯ -->
  <div class="beian">
    <span>
      <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
        é—½ICPå¤‡18009949å·-2
      </a>
    </span>
    
  </div>


  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>












  
    <!-- Baidu Analytics -->
    <script defer>
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?58e161bf4b884b2aa577f323f137ac0f";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  

  

  

  

  

  





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ ä¿æŒåœ¨æœ€åº•éƒ¨ -->
<script  src="/js/boot.js" ></script>


</body>
</html>
